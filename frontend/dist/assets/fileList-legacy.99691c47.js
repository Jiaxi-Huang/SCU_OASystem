!function(){function e(e){return function(e){if(Array.isArray(e))return r(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return r(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return r(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function r(e,r){(null==r||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}function t(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,n)}return t}function n(e){for(var r=1;r<arguments.length;r++){var n=null!=arguments[r]?arguments[r]:{};r%2?t(Object(n),!0).forEach((function(r){a(e,r,n[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):t(Object(n)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))}))}return e}function a(e,r,t){return r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function i(e,r){for(var t=0;t<r.length;t++){var n=r[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}System.register(["./index-legacy.ec536723.js","./vendor-legacy.2803936c.js"],(function(r){"use strict";var t,a,o,l,d,s,u,c,f;return{setters:[function(e){t=e.r,a=e._},function(e){o=e.E,l=e.e,d=e.m,s=e.f,u=e.g,c=e.t,f=e.i}],execute:function(){var m="http://127.0.0.1:8080/api",p="/file/loadFile",h="/folder/loadFolder",g="/folder/createFolder",_="/folder/modifyFolder",y="/folder/moveFolder",F="/folder/delFolder",v="/file/moveFile",k="/file/delFile",S="/file/remarkFile",T="/file/uploadFile",w="/file/modifyFile",b="/file/judgeFileType",I=function(){function e(){!function(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}(this,e)}var r,n,a;return r=e,a=[{key:"loadFile",value:function(e){var r={acsTkn:sessionStorage.getItem("accessToken"),dirId:e};return t({url:m+p,method:"POST",json:!0,data:r}).then((function(e){return 0===e.status?e:null}))}},{key:"loadFolder",value:function(e){var r={accessToken:sessionStorage.getItem("accessToken")};return t({url:m+h,method:"POST",json:!0,data:r}).then((function(e){return 0===e.status?e:null}))}},{key:"createFolder",value:function(e){var r={title:e.folder_name,pid:e.folder_pid,acsTkn:sessionStorage.getItem("accessToken")};return t({url:m+g,method:"POST",json:!0,data:r}).then((function(e){return 0===e.status?e:(-1===e.status&&o.error("您的权限不够，无法创建文件夹"),null)}))}},{key:"modifyFolder",value:function(e){var r={id:e.folder_value,title:e.folder_name,acsTkn:sessionStorage.getItem("accessToken")};return t({url:m+_,method:"POST",json:!0,data:r}).then((function(e){return 0===e.status?e:(-1===e.status&&o.error("您的权限不够，无法修改文件夹名称"),null)}))}},{key:"moveFolder",value:function(e){var r={id:e.current_id,pid:e.target_pid,acsTkn:sessionStorage.getItem("accessToken")};return t({url:m+y,method:"POST",json:!0,data:r}).then((function(e){return 0===e.status?e:(-1===e.status&&o.error("您的权限不够，无法移动文件夹"),-2===e.status&&o.error("无法移动总文件夹"),null)}))}},{key:"delFolder",value:function(e){var r={id:e.id,acsTkn:sessionStorage.getItem("accessToken")};return t({url:m+F,method:"POST",json:!0,data:r}).then((function(e){return 0===e.status?e:(-1===e.status&&o.error("您的权限不够，无法删除文件夹"),-2===e.status&&o.error("无法删除总文件夹"),null)}))}},{key:"moveFile",value:function(e){var r={ids:e.select_file_id,dirId:e.target_pid,beforeDirId:e.select_file_before_dir_id,acsTkn:sessionStorage.getItem("accessToken")};return t({url:m+v,method:"POST",json:!0,data:r}).then((function(e){return 0===e.status?e:(-1===e.status&&o.error("您的权限不够，无法移动文件"),null)}))}},{key:"delFile",value:function(e){var r={ids:e.select_file_id,beforeDirId:e.select_file_before_dir_id,acsTkn:sessionStorage.getItem("accessToken")};return t({url:m+k,method:"POST",json:!0,data:r}).then((function(e){return 0===e.status?e:(-1===e.status&&o.error("您的权限不够，无法删除文件"),null)}))}},{key:"remarkFile",value:function(e){var r={ids:e.select_file_id,remark:e.remark_content,beforeDirId:e.select_file_before_dir_id,acsTkn:sessionStorage.getItem("accessToken")};return t({url:m+S,method:"POST",json:!0,data:r}).then((function(e){return 0===e.status?e:(-1===e.status&&o.error("您的权限不够，无法备注文件"),null)}))}},{key:"modifyFile",value:function(e){var r={id:e.id,fileName:e.file_name,dirId:e.dir_id,acsTkn:sessionStorage.getItem("accessToken")};return t({url:m+w,method:"POST",json:!0,data:r}).then((function(e){return 0===e.status?e:(-1===e.status&&o.error("您的权限不够，无法修改文件名称"),null)}))}},{key:"judgeFileType",value:function(e){return t({url:m+b,method:"POST",json:!0,data:{dirId:e}}).then((function(e){return 0===e.status?e.data[0]:null}))}},{key:"uploadFile",value:function(e){var r=e.record,n=r.file.name.lastIndexOf("."),a={fileName:r.file.name.substring(0,n),ext:r.file.name.substring(n+1),size:r.file.size,userId:r.data.user,dirId:r.data.folder_id};return t({url:m+T,method:"POST",json:!0,data:a}).then((function(e){return 0===e.status?e:null}))}}],(n=null)&&i(r.prototype,n),a&&i(r,a),Object.defineProperty(r,"prototype",{writable:!1}),e}(),O=l({name:"App",setup:function(){function r(e){var r=new Date(e),t=r.getFullYear(),n=(r.getMonth()+1).toString().padStart(2,"0"),a=r.getDate().toString().padStart(2,"0"),i=r.getHours().toString().padStart(2,"0"),o=r.getMinutes().toString().padStart(2,"0"),l=r.getSeconds().toString().padStart(2,"0");return"".concat(t,"-").concat(n,"-").concat(a," ").concat(i,":").concat(o,":").concat(l)}return{loadFolder:function(e){I.loadFolder().then((function(r){if(r){var t=r.data;t&&Array.isArray(t)&&function(){var r=t[t.length-2],a=t[t.length-1];t.pop(),t.pop();for(var i=function(i){e.data[i].id=-i,e.data[i].children=[];var o={};(t.forEach((function(e){o[e.id]=n(n({},e),{},{children:[]})})),t.forEach((function(t){0!==i||null!==t.department&&""!==t.department||t.userId!==r||0!==t.isShared||(t.pid===-i?e.data[i].children.push(o[t.id]):o[t.pid]&&o[t.pid].children.push(o[t.id])),1===i&&t.department===a&&0===t.isShared&&(t.pid===-i?e.data[i].children.push(o[t.id]):o[t.pid]&&o[t.pid].children.push(o[t.id])),2!==i||null!==t.department&&""!==t.department||1!==t.isShared||(t.pid===-i?e.data[i].children.push(o[t.id]):o[t.pid]&&o[t.pid].children.push(o[t.id]))})),e.keywords)&&(e.searchData[i].children=[],e.searchData[i].children=e.data[i].children,e.data[i].children=[],t.filter((function(r){return r.title.toLowerCase().includes(e.keywords.toLowerCase())})).forEach((function(t){0!==i||null!==t.department&&""!==t.department||t.userId!==r||0!==t.isShared||e.data[i].children.push(o[t.id]),1===i&&t.department===a&&0===t.isShared&&e.data[i].children.push(o[t.id]),2!==i||null!==t.department&&""!==t.department||1!==t.isShared||e.data[i].children.push(o[t.id])})))},o=0;o<=2;o++)i(o)}()}})).catch((function(e){o({type:"warning",message:e.message||"加载文件失败"})}))},saveFolder:function(e){if(!0===e.is_new)try{I.createFolder(e).then((function(r){r&&e.loadFolder()}))}catch(r){o({type:"warning",message:r.message})}else try{I.modifyFolder(e).then((function(r){r&&e.loadFolder()}))}catch(r){o({type:"warning",message:r.message})}},moveFolder:function(e){try{I.moveFolder(e).then((function(r){r&&e.loadFolder()}))}catch(r){o({type:"warning",message:r.message})}},delFolder:function(e){try{I.delFolder(e).then((function(r){r&&e.loadFolder()}))}catch(r){o({type:"warning",message:r.message})}},loadFile:function(t){var n=0;null!=t.filter.dir_id&&(n=t.filter.dir_id),I.loadFile(n).then((function(a){if(a){var i=a.data,o=i[i.length-3],l={userId:i[i.length-2],department:i[i.length-1]};if(i.pop(),i.pop(),i.pop(),i&&Array.isArray(i)){t.data=[];var d=[];if(0===o)if(t.keywords){i=i.filter((function(e){return e.fileName.toLowerCase().includes(t.keywords.toLowerCase())}));for(var s=0;s<i.length;s++)i[s].dirId!==n||i[s].userId!==l.userId||""!==i[s].department&&null!==i[s].department||0!==i[s].isShared||d.push({id:i[s].id,file_name:i[s].fileName,ext:i[s].ext,size:i[s].size,dir_id:i[s].dirId,url:i[s].url,remark:i[s].remark,create_time:r(i[s].createTime),update_time:r(i[s].updateTime),user_name:i[s].userName})}else for(var u=0;u<i.length;u++)i[u].dirId!==n||i[u].userId!==l.userId||""!==i[u].department&&null!==i[u].department||0!==i[u].isShared||d.push({id:i[u].id,file_name:i[u].fileName,ext:i[u].ext,size:i[u].size,dir_id:i[u].dirId,url:i[u].url,remark:i[u].remark,create_time:r(i[u].createTime),update_time:r(i[u].updateTime),user_name:i[u].userName});if(-1===o)if(t.keywords){i=i.filter((function(e){return e.fileName.toLowerCase().includes(t.keywords.toLowerCase())}));for(var c=0;c<i.length;c++)i[c].dirId===t.filter.dir_id&&i[c].department===l.department&&0===i[c].isShared&&d.push({id:i[c].id,file_name:i[c].fileName,ext:i[c].ext,size:i[c].size,dir_id:i[c].dirId,url:i[c].url,remark:i[c].remark,create_time:r(i[c].createTime),update_time:r(i[c].updateTime),user_name:i[c].userName})}else for(var f=0;f<i.length;f++)i[f].dirId===t.filter.dir_id&&i[f].department===l.department&&0===i[f].isShared&&d.push({id:i[f].id,file_name:i[f].fileName,ext:i[f].ext,size:i[f].size,dir_id:i[f].dirId,url:i[f].url,remark:i[f].remark,create_time:r(i[f].createTime),update_time:r(i[f].updateTime),user_name:i[f].userName});if(-2===o)if(t.keywords){i=i.filter((function(e){return e.fileName.toLowerCase().includes(t.keywords.toLowerCase())}));for(var m=0;m<i.length;m++)i[m].dirId!==t.filter.dir_id||""!==i[m].department&&null!==i[m].department||1!==i[m].isShared||d.push({id:i[m].id,file_name:i[m].fileName,ext:i[m].ext,size:i[m].size,dir_id:i[m].dirId,url:i[m].url,remark:i[m].remark,create_time:r(i[m].createTime),update_time:r(i[m].updateTime),user_name:i[m].userName})}else for(var p=0;p<i.length;p++)i[p].dirId!==t.filter.dir_id||""!==i[p].department&&null!==i[p].department||1!==i[p].isShared||d.push({id:i[p].id,file_name:i[p].fileName,ext:i[p].ext,size:i[p].size,dir_id:i[p].dirId,url:i[p].url,remark:i[p].remark,create_time:r(i[p].createTime),update_time:r(i[p].updateTime),user_name:i[p].userName});var h=d.map((function(e){return e.ext})),g=e(new Set(h));t.fileExtensions=g.map((function(e){return{text:".".concat(e),value:e}}));var _=d.filter((function(e){return t.extFilter.includes(e.ext)}));if(t.isExt){for(var y=(t.current_page-1)*t.page_size;y<_.length&&y<t.current_page*t.page_size;y++)t.data.push({id:_[y].id,file_name:_[y].file_name,ext:_[y].ext,size:_[y].size,dir_id:_[y].dir_id,url:_[y].url,remark:_[y].remark,create_time:r(_[y].create_time),update_time:r(_[y].update_time),user_name:_[y].user_name});t.total=_.length}else{for(var F=(t.current_page-1)*t.page_size;F<d.length&&F<t.current_page*t.page_size;F++)t.data.push({id:d[F].id,file_name:d[F].file_name,ext:d[F].ext,size:d[F].size,dir_id:d[F].dir_id,url:d[F].url,remark:d[F].remark,create_time:r(d[F].create_time),update_time:r(d[F].update_time),user_name:d[F].user_name});t.total=d.length}}}})).catch((function(e){o({type:"warning",message:e.message||"加载文件失败"})}))},selectFile:function(e){},moveFile:function(e){try{I.moveFile(e).then((function(r){r&&e.loadFile()}))}catch(r){o({type:"warning",message:r.message})}},delFile:function(e){try{I.delFile(e).then((function(r){r&&e.loadFile()}))}catch(r){o({type:"warning",message:r.message})}},saveFile:function(e){try{I.modifyFile(e).then((function(e){}))}catch(r){o({type:"warning",message:r.message})}},remarkFile:function(e){try{I.remarkFile(e).then((function(r){r&&e.loadFile()}))}catch(r){o({type:"warning",message:r.message})}},beforeUpload:function(e){},onUploadSuccess:function(e){},onUploadError:function(e){},judgeFileType:function(e){try{I.judgeFileType(e).then((function(e){if(e)return e}))}catch(r){o({type:"warning",message:r.message})}}}}}),j=f("h3",null,"文件管理",-1);r("default",a(O,[["render",function(e,r,t,n,a,i){var o=d("vuecmf-fileexplorer");return s(),u("div",null,[j,c(o,{root_path:"个人文件管理",page_size:10,list_show:"list",tool_config:["new_folder","update_folder","move_folder","del_folder","upload","move_file","del_file","remark_file"],upload_api:"http://localhost:8080/api/file/upload",onLoadFolder:e.loadFolder,onMoveFolder:e.moveFolder,onSaveFolder:e.saveFolder,onDelFolder:e.delFolder,onLoadFile:e.loadFile,onSelectFile:e.selectFile,onMoveFile:e.moveFile,onDelFile:e.delFile,onSaveFile:e.saveFile,onRemarkFile:e.remarkFile,onBeforeUpload:e.beforeUpload,onOnUploadSuccess:e.onUploadSuccess,onOnUploadError:e.onUploadError,onJudgeFileType:e.judgeFileType},null,8,["onLoadFolder","onMoveFolder","onSaveFolder","onDelFolder","onLoadFile","onSelectFile","onMoveFile","onDelFile","onSaveFile","onRemarkFile","onBeforeUpload","onOnUploadSuccess","onOnUploadError","onJudgeFileType"])])}]]))}}}))}();
