import{e as $,aQ as E,aT as U,az as N,aU as T,j as I,B as M,r as S,c as R,m as u,f as p,g as F,t as s,s as l,i as h,F as V,v as k,q as z,E as A,Q as D}from"./vendor.e05abf4c.js";import{_ as q,b as v}from"./index.d93954e0.js";const L=$({name:"AdvanceForm",components:{Edit:E,DeleteFilled:U,Check:N,ArrowLeft:T},setup(){I();const e=M({reimbursement_id:0,user_id:0,amount:"",description:"",status:[],submitted_at:"",cc_user:[],notified_user:0}),r=S([]),f=S(),y=()=>{v.getAllUsers().then(n=>{const i=n.data[0]||[];r.value=i.map(a=>({value:a.userId,label:a.username||a.email}))}).catch(n=>{console.error("Failed to fetch users:",n),r.value=[]})};return R(()=>{y()}),{sizeForm:e,all_users:r,activityForm:f,submitForm:()=>{f.value.validate(n=>{if(n){let i=function(o){const m=o.getFullYear(),c=String(o.getMonth()+1).padStart(2,"0"),_=String(o.getDate()).padStart(2,"0"),g=String(o.getHours()).padStart(2,"0"),t=String(o.getMinutes()).padStart(2,"0"),C=String(o.getSeconds()).padStart(2,"0");return`${m}-${c}-${_} ${g}:${t}:${C}`};const a=new Date,b=i(a);let d={accessToken:sessionStorage.getItem("accessToken"),amount:e.amount,description:e.description,status:"\u672A\u5BA1\u6838",submitted_at:b,review_user_id:e.notified_user,cc_user:e.cc_user};console.log("Submission form:",JSON.stringify(d));try{v.addReimbursement(d).then(o=>{e.reimbursement_id=o.data.reimbursement_id,console.log("Reimbursement ID:",e.reimbursement_id),e.cc_user&&e.cc_user.length>0&&e.cc_user.forEach(m=>{let c={notified_user_id:m,request_type:"reimbursement",request_id:e.reimbursement_id,submitted_at:a};v.addNotification(c).then(_=>{console.log("CC Notification added:",_.data)})}),A({type:"success",message:"\u63D0\u4EA4\u6210\u529F"})})}catch(o){A({type:"warning",message:o.message})}return e.reimbursement_id=0,e.user_id=0,e.amount="",e.description="",e.status=[],e.submitted_at="",e.notified_user=0,e.cc_user=[],!0}return console.log("submit error"),!1})},resetForm:()=>{f.value.resetFields()}}}}),Q={class:"FormInfo"},j={class:"grid-content bg-purple-dark"},H={style:{"text-align":"left"}},J=h("span",null,"\u62A5\u9500\u7533\u8BF7",-1),O=D("\u7ACB\u5373\u521B\u5EFA"),Y=D("\u53D6\u6D88");function G(e,r,f,y,w,B){const n=u("el-divider"),i=u("el-input"),a=u("el-form-item"),b=u("el-option"),d=u("el-select"),o=u("el-button"),m=u("el-form"),c=u("el-card"),_=u("el-col"),g=u("el-row");return p(),F("div",Q,[s(g,null,{default:l(()=>[s(_,{offset:1,span:22},{default:l(()=>[h("div",j,[s(c,{class:"box-card"},{default:l(()=>[h("div",H,[J,s(n)]),s(m,{ref:"activityForm",style:{"text-align":"left"},model:e.sizeForm,"label-width":"80px",size:"small"},{default:l(()=>[s(a,{label:"\u91D1\u989D"},{default:l(()=>[s(i,{modelValue:e.sizeForm.amount,"onUpdate:modelValue":r[0]||(r[0]=t=>e.sizeForm.amount=t)},null,8,["modelValue"])]),_:1}),s(a,{label:"\u5185\u5BB9"},{default:l(()=>[s(i,{modelValue:e.sizeForm.description,"onUpdate:modelValue":r[1]||(r[1]=t=>e.sizeForm.description=t),autosize:"",type:"textarea"},null,8,["modelValue"])]),_:1}),s(a,{label:"\u62A5\u9001"},{default:l(()=>[s(d,{modelValue:e.sizeForm.notified_user,"onUpdate:modelValue":r[2]||(r[2]=t=>e.sizeForm.notified_user=t),"collapse-tags":"",placeholder:"\u9009\u62E9\u8981\u62A5\u9001\u7684\u7528\u6237",style:{width:"240px"}},{default:l(()=>[(p(!0),F(V,null,k(e.all_users,t=>(p(),z(b,{key:t.value,label:t.label,value:t.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),s(a,{label:"\u6284\u9001"},{default:l(()=>[s(d,{modelValue:e.sizeForm.cc_user,"onUpdate:modelValue":r[3]||(r[3]=t=>e.sizeForm.cc_user=t),"collapse-tags":"",placeholder:"\u9009\u62E9\u8981\u6284\u9001\u7684\u7528\u6237",style:{width:"240px"},multiple:""},{default:l(()=>[(p(!0),F(V,null,k(e.all_users,t=>(p(),z(b,{key:t.value,label:t.label,value:t.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),s(a,{size:"large"},{default:l(()=>[s(o,{type:"primary",onClick:e.submitForm},{default:l(()=>[O]),_:1},8,["onClick"]),s(o,{onClick:e.resetForm},{default:l(()=>[Y]),_:1},8,["onClick"])]),_:1})]),_:1},8,["model"])]),_:1})])]),_:1})]),_:1})])}var W=q(L,[["render",G]]);export{W as default};
