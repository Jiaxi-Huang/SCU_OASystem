import{e as S,aQ as H,aT as I,az as Y,aU as T,j as M,B as N,r as B,c as q,m as o,f as _,g as f,t as l,s as t,i as g,F as b,v as A,q as y,E as k,p as L,h as R,Q as F}from"./vendor.e05abf4c.js";import{_ as $,d as V}from"./index.d93954e0.js";const O=S({name:"AdvanceForm",components:{Edit:H,DeleteFilled:I,Check:Y,ArrowLeft:T},setup(){M();const e=N({leave_id:0,leave_user_id:"",leave_start_time1:"",leave_start_time2:"",leave_end_time1:"",leave_end_time2:"",leave_type:"",leave_reason:"",leave_status:"\u672A\u5BA1\u6838",leave_submitted_at:"",cc_user:[],notified_user:0}),u=B([]),E=[{value:"\u4E8B\u5047",label:"\u4E8B\u5047"},{value:"\u75C5\u5047",label:"\u75C5\u5047"},{value:"\u5E74\u5047",label:"\u5E74\u5047"},{value:"\u8C03\u4F11",label:"\u8C03\u4F11"},{value:"\u5A5A\u5047",label:"\u5A5A\u5047"},{value:"\u4EA7\u5047",label:"\u4EA7\u5047"},{value:"\u966A\u4EA7\u5047",label:"\u966A\u4EA7\u5047"}],c=B(),z=()=>{V.getAllUsers().then(d=>{const s=d.data[0]||[];u.value=s.map(r=>({value:r.userId,label:r.username||r.email}))}).catch(d=>{console.error("Failed to fetch users:",d),u.value=[]})};return q(()=>{z()}),{sizeForm:e,all_users:u,activityForm:c,leave_type_options:E,submitForm:()=>{c.value.validate(d=>{if(d){const r=new Date().toISOString().slice(0,19).replace("T"," ");let i={accessToken:sessionStorage.getItem("accessToken"),reason:e.leave_reason,start_date:e.leave_start_time1+" "+e.leave_start_time2,end_date:e.leave_end_time1+" "+e.leave_end_time2,submitted_at:r,status:"\u672A\u5BA1\u6838",review_user_id:e.notified_user,cc_user:e.cc_user,type:e.leave_type};console.log("Submission form:",JSON.stringify(i));try{V.addLeaveApproval(i).then(m=>{e.leave_id=m.data.leave_id,e.cc_user&&e.cc_user.length>0&&e.cc_user.forEach(n=>{let p={notified_user_id:n,request_type:"leave",request_id:e.leave_id,submitted_at:r};V.addNotification(p).then(v=>{console.log("CC Notification added:",v.data)})}),k({type:"success",message:"\u63D0\u4EA4\u6210\u529F"})})}catch(m){return k({type:"warning",message:m.message}),console.log("submit error"),!1}return e.leave_start_time1="",e.leave_start_time2="",e.leave_end_time1="",e.leave_end_time2="",e.leave_reason="",e.leave_user_id="",e.leave_status="\u672A\u5BA1\u6838",e.leave_type="",e.notified_user=0,e.cc_user=[],!0}return console.log("submit error"),!1})},resetForm:()=>{c.value.resetFields()}}}}),Q=e=>(L("data-v-3c84b42e"),e=e(),R(),e),j={class:"FormInfo"},J={class:"grid-content bg-purple-dark"},G={style:{"text-align":"left"}},K=Q(()=>g("span",null,"\u8BF7\u5047\u7533\u8BF7",-1)),P=F("\xA0\xA0\xA0\xA0-"),W=F("\xA0\xA0\xA0\xA0-"),X=F("\u63D0\u4EA4\u7533\u8BF7"),Z=F("\u53D6\u6D88");function x(e,u,E,c,z,w){const h=o("el-divider"),d=o("el-input"),s=o("el-form-item"),r=o("el-option"),i=o("el-select"),m=o("el-date-picker"),n=o("el-col"),p=o("el-time-picker"),v=o("el-button"),C=o("el-form"),D=o("el-card"),U=o("el-row");return _(),f("div",j,[l(U,null,{default:t(()=>[l(n,{offset:1,span:22},{default:t(()=>[g("div",J,[l(D,{class:"box-card"},{default:t(()=>[g("div",G,[K,l(h)]),l(C,{ref:"activityForm",style:{"text-align":"left"},model:e.sizeForm,"label-width":"80px",size:"small"},{default:t(()=>[l(s,{label:"\u8BF7\u5047\u539F\u56E0"},{default:t(()=>[l(d,{modelValue:e.sizeForm.leave_reason,"onUpdate:modelValue":u[0]||(u[0]=a=>e.sizeForm.leave_reason=a)},null,8,["modelValue"])]),_:1}),l(s,{label:"\u8BF7\u5047\u7C7B\u578B"},{default:t(()=>[l(i,{modelValue:e.sizeForm.leave_type,"onUpdate:modelValue":u[1]||(u[1]=a=>e.sizeForm.leave_type=a)},{default:t(()=>[(_(!0),f(b,null,A(e.leave_type_options,a=>(_(),y(r,{key:a.value,label:a.label,value:a.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(s,{label:"\u5F00\u59CB\u65F6\u95F4"},{default:t(()=>[l(n,{span:11},{default:t(()=>[l(m,{modelValue:e.sizeForm.leave_start_time1,"onUpdate:modelValue":u[2]||(u[2]=a=>e.sizeForm.leave_start_time1=a),type:"date",placeholder:"\u9009\u62E9\u65E5\u671F",style:{width:"100%"},"value-format":"YYYY-MM-DD"},null,8,["modelValue"])]),_:1}),l(n,{class:"line",span:1},{default:t(()=>[P]),_:1}),l(n,{span:12},{default:t(()=>[l(p,{modelValue:e.sizeForm.leave_start_time2,"onUpdate:modelValue":u[3]||(u[3]=a=>e.sizeForm.leave_start_time2=a),placeholder:"\u9009\u62E9\u65F6\u95F4",style:{width:"100%"},format:"HH:mm","value-format":"HH:mm"},null,8,["modelValue"])]),_:1})]),_:1}),l(s,{label:"\u7ED3\u675F\u65F6\u95F4"},{default:t(()=>[l(n,{span:11},{default:t(()=>[l(m,{modelValue:e.sizeForm.leave_end_time1,"onUpdate:modelValue":u[4]||(u[4]=a=>e.sizeForm.leave_end_time1=a),type:"date",placeholder:"\u9009\u62E9\u65E5\u671F",style:{width:"100%"},"value-format":"YYYY-MM-DD"},null,8,["modelValue"])]),_:1}),l(n,{class:"line",span:1},{default:t(()=>[W]),_:1}),l(n,{span:12},{default:t(()=>[l(p,{modelValue:e.sizeForm.leave_end_time2,"onUpdate:modelValue":u[5]||(u[5]=a=>e.sizeForm.leave_end_time2=a),placeholder:"\u9009\u62E9\u65F6\u95F4",style:{width:"100%"},format:"HH:mm","value-format":"HH:mm"},null,8,["modelValue"])]),_:1})]),_:1}),l(s,{label:"\u62A5\u9001"},{default:t(()=>[l(i,{modelValue:e.sizeForm.notified_user,"onUpdate:modelValue":u[6]||(u[6]=a=>e.sizeForm.notified_user=a),"collapse-tags":"",placeholder:"\u9009\u62E9\u8981\u62A5\u9001\u7684\u7528\u6237",style:{width:"240px"}},{default:t(()=>[(_(!0),f(b,null,A(e.all_users,a=>(_(),y(r,{key:a.value,label:a.label,value:a.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(s,{label:"\u6284\u9001"},{default:t(()=>[l(i,{modelValue:e.sizeForm.cc_user,"onUpdate:modelValue":u[7]||(u[7]=a=>e.sizeForm.cc_user=a),"collapse-tags":"",placeholder:"\u9009\u62E9\u8981\u6284\u9001\u7684\u7528\u6237",style:{width:"240px"},multiple:""},{default:t(()=>[(_(!0),f(b,null,A(e.all_users,a=>(_(),y(r,{key:a.value,label:a.label,value:a.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(s,{size:"large"},{default:t(()=>[l(v,{type:"primary",onClick:e.submitForm},{default:t(()=>[X]),_:1},8,["onClick"]),l(v,null,{default:t(()=>[Z]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})])]),_:1})]),_:1})])}var ae=$(O,[["render",x],["__scopeId","data-v-3c84b42e"]]);export{ae as default};
