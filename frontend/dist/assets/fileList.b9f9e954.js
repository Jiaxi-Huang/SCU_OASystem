var C=Object.defineProperty,U=Object.defineProperties;var A=Object.getOwnPropertyDescriptors;var T=Object.getOwnPropertySymbols;var L=Object.prototype.hasOwnProperty,z=Object.prototype.propertyIsEnumerable;var E=(n,i,s)=>i in n?C(n,i,{enumerable:!0,configurable:!0,writable:!0,value:s}):n[i]=s,I=(n,i)=>{for(var s in i||(i={}))L.call(i,s)&&E(n,s,i[s]);if(T)for(var s of T(i))z.call(i,s)&&E(n,s,i[s]);return n},v=(n,i)=>U(n,A(i));import{r as h,_ as D}from"./index.63817855.js";import{E as m,e as N,m as x,f as R,g as B,t as P,i as $}from"./vendor.e05abf4c.js";const o={baseURL:"http://127.0.0.1:8080/api",loadFile:"/file/loadFile",loadFolder:"/folder/loadFolder",createFolder:"/folder/createFolder",modifyFolder:"/folder/modifyFolder",moveFolder:"/folder/moveFolder",delFolder:"/folder/delFolder",moveFile:"/file/moveFile",delFile:"/file/delFile",remarkFile:"/file/remarkFile",uploadFile:"/file/uploadFile",modifyFile:"/file/modifyFile",judgeFileType:"/file/judgeFileType"};class _{static loadFile(i){const s={acsTkn:sessionStorage.getItem("accessToken"),dirId:i};return h({url:o.baseURL+o.loadFile,method:"POST",json:!0,data:s}).then(d=>d.status===0?d:null)}static loadFolder(i){const s={accessToken:sessionStorage.getItem("accessToken")};return h({url:o.baseURL+o.loadFolder,method:"POST",json:!0,data:s}).then(d=>d.status===0?d:null)}static createFolder(i){let s={title:i.folder_name,pid:i.folder_pid,acsTkn:sessionStorage.getItem("accessToken")};return h({url:o.baseURL+o.createFolder,method:"POST",json:!0,data:s}).then(d=>d.status===0?d:(d.status===-1&&m.error("\u60A8\u7684\u6743\u9650\u4E0D\u591F\uFF0C\u65E0\u6CD5\u521B\u5EFA\u6587\u4EF6\u5939"),null))}static modifyFolder(i){let s={id:i.folder_value,title:i.folder_name,acsTkn:sessionStorage.getItem("accessToken")};return h({url:o.baseURL+o.modifyFolder,method:"POST",json:!0,data:s}).then(d=>d.status===0?d:(d.status===-1&&m.error("\u60A8\u7684\u6743\u9650\u4E0D\u591F\uFF0C\u65E0\u6CD5\u4FEE\u6539\u6587\u4EF6\u5939\u540D\u79F0"),null))}static moveFolder(i){let s={id:i.current_id,pid:i.target_pid,acsTkn:sessionStorage.getItem("accessToken")};return h({url:o.baseURL+o.moveFolder,method:"POST",json:!0,data:s}).then(d=>d.status===0?d:(d.status===-1&&m.error("\u60A8\u7684\u6743\u9650\u4E0D\u591F\uFF0C\u65E0\u6CD5\u79FB\u52A8\u6587\u4EF6\u5939"),d.status===-2&&m.error("\u65E0\u6CD5\u79FB\u52A8\u603B\u6587\u4EF6\u5939"),null))}static delFolder(i){let s={id:i.id,acsTkn:sessionStorage.getItem("accessToken")};return h({url:o.baseURL+o.delFolder,method:"POST",json:!0,data:s}).then(d=>d.status===0?d:(d.status===-1&&m.error("\u60A8\u7684\u6743\u9650\u4E0D\u591F\uFF0C\u65E0\u6CD5\u5220\u9664\u6587\u4EF6\u5939"),d.status===-2&&m.error("\u65E0\u6CD5\u5220\u9664\u603B\u6587\u4EF6\u5939"),null))}static moveFile(i){let s={ids:i.select_file_id,dirId:i.target_pid,beforeDirId:i.select_file_before_dir_id,acsTkn:sessionStorage.getItem("accessToken")};return h({url:o.baseURL+o.moveFile,method:"POST",json:!0,data:s}).then(d=>d.status===0?d:(d.status===-1&&m.error("\u60A8\u7684\u6743\u9650\u4E0D\u591F\uFF0C\u65E0\u6CD5\u79FB\u52A8\u6587\u4EF6"),null))}static delFile(i){let s={ids:i.select_file_id,beforeDirId:i.select_file_before_dir_id,acsTkn:sessionStorage.getItem("accessToken")};return h({url:o.baseURL+o.delFile,method:"POST",json:!0,data:s}).then(d=>d.status===0?d:(d.status===-1&&m.error("\u60A8\u7684\u6743\u9650\u4E0D\u591F\uFF0C\u65E0\u6CD5\u5220\u9664\u6587\u4EF6"),null))}static remarkFile(i){let s={ids:i.select_file_id,remark:i.remark_content,beforeDirId:i.select_file_before_dir_id,acsTkn:sessionStorage.getItem("accessToken")};return h({url:o.baseURL+o.remarkFile,method:"POST",json:!0,data:s}).then(d=>d.status===0?d:(d.status===-1&&m.error("\u60A8\u7684\u6743\u9650\u4E0D\u591F\uFF0C\u65E0\u6CD5\u5907\u6CE8\u6587\u4EF6"),null))}static modifyFile(i){let s={id:i.id,fileName:i.file_name,dirId:i.dir_id,acsTkn:sessionStorage.getItem("accessToken")};return h({url:o.baseURL+o.modifyFile,method:"POST",json:!0,data:s}).then(d=>d.status===0?d:(d.status===-1&&m.error("\u60A8\u7684\u6743\u9650\u4E0D\u591F\uFF0C\u65E0\u6CD5\u4FEE\u6539\u6587\u4EF6\u540D\u79F0"),null))}static judgeFileType(i){let s={dirId:i};return h({url:o.baseURL+o.judgeFileType,method:"POST",json:!0,data:s}).then(d=>d.status===0?d.data[0]:null)}static uploadFile(i){let s=i.record,d=s.file.name.lastIndexOf("."),k=s.file.name.substring(0,d),S=s.file.name.substring(d+1),g={fileName:k,ext:S,size:s.file.size,userId:s.data.user,dirId:s.data.folder_id};return h({url:o.baseURL+o.uploadFile,method:"POST",json:!0,data:g}).then(y=>y.status===0?y:null)}}const M=N({name:"App",setup(){const n=t=>{_.loadFolder().then(a=>{if(a){const F=a.data;if(F&&Array.isArray(F)){let r={userId:F[F.length-2],department:F[F.length-1]};F.pop(),F.pop();for(let u=0;u<=2;u++){t.data[u].id=-u,t.data[u].children=[];let c={};F.forEach(l=>{c[l.id]=v(I({},l),{children:[]})}),F.forEach(l=>{u===0&&(l.department===null||l.department==="")&&l.userId===r.userId&&l.isShared===0&&(l.pid===-u?t.data[u].children.push(c[l.id]):c[l.pid]&&c[l.pid].children.push(c[l.id])),u===1&&l.department===r.department&&l.isShared===0&&(l.pid===-u?t.data[u].children.push(c[l.id]):c[l.pid]&&c[l.pid].children.push(c[l.id])),u===2&&(l.department===null||l.department==="")&&l.isShared===1&&(l.pid===-u?t.data[u].children.push(c[l.id]):c[l.pid]&&c[l.pid].children.push(c[l.id]))}),t.keywords&&(t.searchData[u].children=[],t.searchData[u].children=t.data[u].children,t.data[u].children=[],F.filter(p=>p.title.toLowerCase().includes(t.keywords.toLowerCase())).forEach(p=>{u===0&&(p.department===null||p.department==="")&&p.userId===r.userId&&p.isShared===0&&t.data[u].children.push(c[p.id]),u===1&&p.department===r.department&&p.isShared===0&&t.data[u].children.push(c[p.id]),u===2&&(p.department===null||p.department==="")&&p.isShared===1&&t.data[u].children.push(c[p.id])}))}}}}).catch(a=>{m({type:"warning",message:a.message||"\u52A0\u8F7D\u6587\u4EF6\u5931\u8D25"})})};function i(t){const a=new Date(t),F=a.getFullYear(),r=(a.getMonth()+1).toString().padStart(2,"0"),u=a.getDate().toString().padStart(2,"0"),c=a.getHours().toString().padStart(2,"0"),l=a.getMinutes().toString().padStart(2,"0"),p=a.getSeconds().toString().padStart(2,"0");return`${F}-${r}-${u} ${c}:${l}:${p}`}return{loadFolder:n,saveFolder:t=>{if(t.is_new===!0)try{_.createFolder(t).then(a=>{a&&t.loadFolder()})}catch(a){m({type:"warning",message:a.message})}else try{_.modifyFolder(t).then(a=>{a&&t.loadFolder()})}catch(a){m({type:"warning",message:a.message})}},moveFolder:t=>{try{_.moveFolder(t).then(a=>{a&&t.loadFolder()})}catch(a){m({type:"warning",message:a.message})}},delFolder:t=>{try{_.delFolder(t).then(a=>{a&&t.loadFolder()})}catch(a){m({type:"warning",message:a.message})}},loadFile:t=>{let a=0;t.filter.dir_id!=null&&(a=t.filter.dir_id),_.loadFile(a).then(F=>{if(F){let r=F.data,u=r[r.length-3],c={userId:r[r.length-2],department:r[r.length-1]};if(r.pop(),r.pop(),r.pop(),r&&Array.isArray(r)){t.data=[];let l=[];if(u===0)if(t.keywords){r=r.filter(e=>e.fileName.toLowerCase().includes(t.keywords.toLowerCase()));for(let e=0;e<r.length;e++)r[e].dirId===a&&r[e].userId===c.userId&&(r[e].department===""||r[e].department===null)&&r[e].isShared===0&&l.push({id:r[e].id,file_name:r[e].fileName,ext:r[e].ext,size:r[e].size,dir_id:r[e].dirId,url:r[e].url,remark:r[e].remark,create_time:i(r[e].createTime),update_time:i(r[e].updateTime),user_name:r[e].userName})}else for(let e=0;e<r.length;e++)r[e].dirId===a&&r[e].userId===c.userId&&(r[e].department===""||r[e].department===null)&&r[e].isShared===0&&l.push({id:r[e].id,file_name:r[e].fileName,ext:r[e].ext,size:r[e].size,dir_id:r[e].dirId,url:r[e].url,remark:r[e].remark,create_time:i(r[e].createTime),update_time:i(r[e].updateTime),user_name:r[e].userName});if(u===-1)if(t.keywords){r=r.filter(e=>e.fileName.toLowerCase().includes(t.keywords.toLowerCase()));for(let e=0;e<r.length;e++)r[e].dirId===t.filter.dir_id&&r[e].department===c.department&&r[e].isShared===0&&l.push({id:r[e].id,file_name:r[e].fileName,ext:r[e].ext,size:r[e].size,dir_id:r[e].dirId,url:r[e].url,remark:r[e].remark,create_time:i(r[e].createTime),update_time:i(r[e].updateTime),user_name:r[e].userName})}else for(let e=0;e<r.length;e++)r[e].dirId===t.filter.dir_id&&r[e].department===c.department&&r[e].isShared===0&&l.push({id:r[e].id,file_name:r[e].fileName,ext:r[e].ext,size:r[e].size,dir_id:r[e].dirId,url:r[e].url,remark:r[e].remark,create_time:i(r[e].createTime),update_time:i(r[e].updateTime),user_name:r[e].userName});if(u===-2)if(t.keywords){r=r.filter(e=>e.fileName.toLowerCase().includes(t.keywords.toLowerCase()));for(let e=0;e<r.length;e++)r[e].dirId===t.filter.dir_id&&(r[e].department===""||r[e].department===null)&&r[e].isShared===1&&l.push({id:r[e].id,file_name:r[e].fileName,ext:r[e].ext,size:r[e].size,dir_id:r[e].dirId,url:r[e].url,remark:r[e].remark,create_time:i(r[e].createTime),update_time:i(r[e].updateTime),user_name:r[e].userName})}else for(let e=0;e<r.length;e++)r[e].dirId===t.filter.dir_id&&(r[e].department===""||r[e].department===null)&&r[e].isShared===1&&l.push({id:r[e].id,file_name:r[e].fileName,ext:r[e].ext,size:r[e].size,dir_id:r[e].dirId,url:r[e].url,remark:r[e].remark,create_time:i(r[e].createTime),update_time:i(r[e].updateTime),user_name:r[e].userName});const p=l.map(e=>e.ext),w=[...new Set(p)];t.fileExtensions=w.map(e=>({text:`.${e}`,value:e}));let f=l.filter(e=>t.extFilter.includes(e.ext));if(t.isExt){for(let e=(t.current_page-1)*t.page_size;e<f.length&&e<t.current_page*t.page_size;e++)t.data.push({id:f[e].id,file_name:f[e].file_name,ext:f[e].ext,size:f[e].size,dir_id:f[e].dir_id,url:f[e].url,remark:f[e].remark,create_time:i(f[e].create_time),update_time:i(f[e].update_time),user_name:f[e].user_name});t.total=f.length}else{for(let e=(t.current_page-1)*t.page_size;e<l.length&&e<t.current_page*t.page_size;e++)t.data.push({id:l[e].id,file_name:l[e].file_name,ext:l[e].ext,size:l[e].size,dir_id:l[e].dir_id,url:l[e].url,remark:l[e].remark,create_time:i(l[e].create_time),update_time:i(l[e].update_time),user_name:l[e].user_name});t.total=l.length}}}}).catch(F=>{m({type:"warning",message:F.message||"\u52A0\u8F7D\u6587\u4EF6\u5931\u8D25"})})},selectFile:t=>{},moveFile:t=>{try{_.moveFile(t).then(a=>{a&&t.loadFile()})}catch(a){m({type:"warning",message:a.message})}},delFile:t=>{try{_.delFile(t).then(a=>{a&&t.loadFile()})}catch(a){m({type:"warning",message:a.message})}},saveFile:t=>{try{_.modifyFile(t).then(a=>{})}catch(a){m({type:"warning",message:a.message})}},remarkFile:t=>{try{_.remarkFile(t).then(a=>{a&&t.loadFile()})}catch(a){m({type:"warning",message:a.message})}},beforeUpload:t=>{},onUploadSuccess:t=>{},onUploadError:t=>{},judgeFileType:t=>{try{_.judgeFileType(t).then(a=>{if(a)return a})}catch(a){m({type:"warning",message:a.message})}}}}}),q=$("h3",null,"\u6587\u4EF6\u7BA1\u7406",-1);function J(n,i,s,d,k,S){const g=x("vuecmf-fileexplorer");return R(),B("div",null,[q,P(g,{root_path:"\u4E2A\u4EBA\u6587\u4EF6\u7BA1\u7406",page_size:10,list_show:"list",tool_config:["new_folder","update_folder","move_folder","del_folder","upload","move_file","del_file","remark_file"],upload_api:"http://localhost:8080/api/file/upload",onLoadFolder:n.loadFolder,onMoveFolder:n.moveFolder,onSaveFolder:n.saveFolder,onDelFolder:n.delFolder,onLoadFile:n.loadFile,onSelectFile:n.selectFile,onMoveFile:n.moveFile,onDelFile:n.delFile,onSaveFile:n.saveFile,onRemarkFile:n.remarkFile,onBeforeUpload:n.beforeUpload,onOnUploadSuccess:n.onUploadSuccess,onOnUploadError:n.onUploadError,onJudgeFileType:n.judgeFileType},null,8,["onLoadFolder","onMoveFolder","onSaveFolder","onDelFolder","onLoadFile","onSelectFile","onMoveFile","onDelFile","onSaveFile","onRemarkFile","onBeforeUpload","onOnUploadSuccess","onOnUploadError","onJudgeFileType"])])}var j=D(M,[["render",J]]);export{j as default};
