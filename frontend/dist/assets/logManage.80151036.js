var te=Object.defineProperty,oe=Object.defineProperties;var ne=Object.getOwnPropertyDescriptors;var x=Object.getOwnPropertySymbols;var ae=Object.prototype.hasOwnProperty,se=Object.prototype.propertyIsEnumerable;var Q=(e,o,t)=>o in e?te(e,o,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[o]=t,B=(e,o)=>{for(var t in o||(o={}))ae.call(o,t)&&Q(e,t,o[t]);if(x)for(var t of x(o))se.call(o,t)&&Q(e,t,o[t]);return e},v=(e,o)=>oe(e,ne(o));import{r as L,_ as P}from"./index.d93954e0.js";import{aI as le,aJ as ue,aK as ie,aL as re,aM as ce,aN as de,J as pe,e as O,r as N,B as V,k as A,c as J,D as U,aq as ge,m as i,f as R,g as j,t as n,s,i as p,y as w,p as me,h as he,Q as h,R as _e,aB as W,O as G,aS as Ce,aR as fe,aF as De,aO as Fe,aP as we,aQ as ye,aG as be,aH as Ee,ax as Be,w as ve,q as Le,N as T,E as _}from"./vendor.e05abf4c.js";const f={baseURL:"http://127.0.0.1:8080/api",postAdminQueryLogList:"/log/list",postAdminDeleteLog:"/log/delete",postAdminExportLog:"/log/export",postAdminPrintLog:"/log/download"};class S{static postAdminQueryLogList(o){return L({url:f.baseURL+f.postAdminQueryLogList,method:"POST",json:!0,data:o}).then(t=>t.status===0?Promise.resolve(t):Promise.reject(t))}static postAdminDeleteLog(o){return L({url:f.baseURL+f.postAdminDeleteLog,method:"POST",json:!0,data:o}).then(t=>t.status===0?Promise.resolve(t):Promise.reject(t))}static postAdminExportLog(o){return L({url:f.baseURL+f.postAdminExportLog,method:"POST",responseType:"blob",json:!0,data:o}).then(t=>{if(t)if(t instanceof Blob){const c=window.URL.createObjectURL(t),r=document.createElement("a");r.href=c,r.setAttribute("download","\u64CD\u4F5C\u65E5\u5FD7_"+new Date().getTime()+".xls"),document.body.appendChild(r),r.click(),document.body.removeChild(r)}else console.error("\u54CD\u5E94\u6570\u636E\u4E0D\u662F Blob \u7C7B\u578B")}).catch(t=>{throw console.error("Error downloading excel:",t),t})}static postAdminPrintLog(o){return L({url:f.baseURL+f.postAdminPrintLog,method:"POST",responseType:"blob",json:!0,data:o}).then(t=>{if(t)if(t instanceof Blob){const c=window.URL.createObjectURL(t),r=document.createElement("a");r.href=c,r.setAttribute("download","\u64CD\u4F5C\u65E5\u5FD7_"+new Date().getTime()+".pdf"),document.body.appendChild(r),r.click(),document.body.removeChild(r)}else console.error("\u54CD\u5E94\u6570\u636E\u4E0D\u662F Blob \u7C7B\u578B")}).catch(t=>{throw console.error("Error downloading pdf:",t),t})}}le([ue,ie,re,ce,de]);let z;const q=(e,o)=>{const t=pe(e);z={tooltip:{trigger:"item"},legend:{top:"2%",left:"center"},series:[{type:"pie",radius:["40%","70%"],avoidLabelOverlap:!1,itemStyle:{borderRadius:10,borderColor:"#fff",borderWidth:2},label:{show:!1,position:"center"},emphasis:{label:{show:!0,fontSize:"20",fontWeight:"bold"}},labelLine:{show:!1},data:o}]},z&&t.setOption(z)};const Se=O({name:"LogStatistic",props:{data:{type:Array,default:()=>[]}},setup(e){const o=N(null),t=N(null),c=V({data:e.data||[]}),r=A(()=>c.data.length),D=A(()=>{const u={};return c.data.forEach(d=>{u[d.userId]=(u[d.userId]||0)+1}),u}),g=A(()=>{const u={};return c.data.forEach(d=>{u[d.logContent]=(u[d.logContent]||0)+1}),u}),m=()=>{ge(()=>{o.value?q(o.value,Object.entries(D.value).map(([u,d])=>({name:u,value:d}))):console.log("refLogsIdChart not exist!"),t.value?q(t.value,Object.entries(g.value).map(([u,d])=>({name:u,value:d}))):console.log("refLogsContentChart not exist!")})};return J(()=>{m()}),v(B({},U(c)),{displayChart:m,idsCount:D,contentsCount:g,refLogsIdChart:o,refLogsContentChart:t,totalLogsCount:r})}}),K=e=>(me("data-v-7a423f7e"),e=e(),he(),e),Ae=K(()=>p("span",null,[p("i",{class:"icon-square red"}),h(" \u603B\u6570")],-1)),Re=h(),ke={class:"id"},Ie=K(()=>p("h3",null,"\u6309\u7F16\u53F7\u7EDF\u8BA1",-1)),$e={class:"e-chart",style:{height:"201px",width:"100%"}},Te={ref:"refLogsIdChart",style:{width:"inherit",height:"inherit"}},ze={class:"content"},Pe=K(()=>p("h3",null,"\u6309\u5185\u5BB9\u7EDF\u8BA1",-1)),Oe={class:"e-chart",style:{height:"401px",width:"100%"}},Ve={ref:"refLogsContentChart",style:{width:"inherit",height:"inherit"}};function Ue(e,o,t,c,r,D){const g=i("el-card");return R(),j("div",null,[n(g,{shadow:"hover",class:"card"},{default:s(()=>[p("p",null,[Ae,Re,p("span",null,w(e.totalLogsCount),1)]),p("div",ke,[Ie,p("div",$e,[p("div",Te,null,512)])]),p("div",ze,[Pe,p("div",Oe,[p("div",Ve,null,512)])])]),_:1})])}var je=P(Se,[["render",Ue],["__scopeId","data-v-7a423f7e"]]);const Ke=O({name:"LogDetail",props:{currentRow:{type:Object,default:()=>({id:null,userId:null,logContent:"",logDate:""})}},setup(e){const o=_e(e,"currentRow"),t=V({loading:!1,form:{id:1,userId:1,logContent:"",logDate:""}}),c=A(()=>o.value);return v(B({},U(t)),{row:c})}}),Me={class:"new"};function xe(e,o,t,c,r,D){const g=i("el-descriptions-item"),m=i("el-descriptions"),u=W("loading");return G((R(),j("div",Me,[n(m,{column:1,border:""},{default:s(()=>[n(g,{label:"\u65E5\u5FD7\u7F16\u53F7"},{default:s(()=>[h(w(e.row.id),1)]),_:1}),n(g,{label:"\u64CD\u4F5C\u7528\u6237\u7F16\u53F7"},{default:s(()=>[h(w(e.row.userId),1)]),_:1}),n(g,{label:"\u64CD\u4F5C\u5185\u5BB9"},{default:s(()=>[h(w(e.row.logContent),1)]),_:1}),n(g,{label:"\u64CD\u4F5C\u65F6\u95F4"},{default:s(()=>[h(w(e.row.logDate),1)]),_:1})]),_:1})])),[[u,e.loading]])}var Qe=P(Ke,[["render",xe],["__scopeId","data-v-848c77b0"]]);const Ne=O({name:"LogManage",components:{LogDetail:Qe,LogStatistic:je,Delete:Ce,Odometer:fe,InfoFilled:De,Printer:Fe,Download:we,Edit:ye,Minus:be,Plus:Ee,Refresh:Be},setup(){const e=V({url:{r:"/log/list",d:"/log/delete"},param:{total:0,size:10,page:1},data:[],filteredData:[],loading:!1,is_search:!1,detail_visible:!1,statistic_visible:!1,posted:{logRow:{id:null,userId:null,logContent:"",logDate:""}},sortField:"",sortOrder:"",ids:[],selectionRows:[],searchKeyword:""}),o=()=>e.sortField?[...e.data].sort((a,l)=>{const F=a[e.sortField],E=l[e.sortField];return F<E?e.sortOrder==="asc"?-1:1:F>E?e.sortOrder==="asc"?1:-1:0}):e.data,t=({prop:a,order:l})=>{e.sortField=a,e.sortOrder=l==="ascending"?"asc":"desc"},c=a=>{e.selectionRows=a.map(l=>l.id),console.log("SelectionRows",e.selectionRows)},r=async()=>{e.is_search=!1;const a={accessToken:sessionStorage.getItem("accessToken")},l=await S.postAdminQueryLogList(a);l.status===0&&(e.data=l.data,e.ids=l.data.map(F=>F.id),e.param.total=e.data.length)},D=a=>{e.param.page=a},g=a=>{e.param.page=1,e.param.size=a},m=(a,l)=>{console.log("row",l),e.posted.logRow.id=l.id,e.posted.logRow.userId=l.userId,e.posted.logRow.logContent=l.logContent,e.posted.logRow.logDate=l.logDate,e.detail_visible=!0},u=()=>e.is_search?o().filter(a=>a.logContent.toLowerCase().includes(e.searchKeyword.toLowerCase())||a.logDate.toLowerCase().includes(e.searchKeyword.toLowerCase())).slice((e.param.page-1)*e.param.size,e.param.page*e.param.size):o().slice((e.param.page-1)*e.param.size,e.param.page*e.param.size),d=()=>{e.searchKeyword!==""?(e.is_search=!0,e.param.page=1,e.filteredData=e.data.filter(a=>a.logContent.toLowerCase().includes(e.searchKeyword.toLowerCase())||a.logDate.toLowerCase().includes(e.searchKeyword.toLowerCase())),e.param.total=e.filteredData.length):(e.is_search=!1,e.param.page=1,e.param.total=e.data.length)},y=async()=>{T.confirm("\u6B64\u64CD\u4F5C\u5C06\u5220\u9664\u8FD9\u4E9B\u64CD\u4F5C\u65E5\u5FD7\uFF08\u4F60\u7684\u5220\u9664\u884C\u4E3A\u4F9D\u7136\u4F1A\u88AB\u8BB0\u5F55\uFF09, \u662F\u5426\u7EE7\u7EED?","\u63D0\u793A",{confirmButtonText:"\u786E\u5B9A",cancelButtonText:"\u53D6\u6D88",type:"warning"}).then(async()=>{const l={ids:e.selectionRows.length>0?e.selectionRows:e.ids,accessToken:sessionStorage.getItem("accessToken")};(await S.postAdminDeleteLog(l)).status===0?(_({type:"success",message:"\u5220\u9664\u6210\u529F"}),await r()):_({type:"error",message:"\u5220\u9664\u5931\u8D25"})}).catch(()=>{_({type:"info",message:"\u5DF2\u53D6\u6D88\u5220\u9664"})})},k=async()=>{await y()},b=async()=>{T.confirm("\u786E\u5B9A\u8981\u5BFC\u51FA\u4E3AExcel\u5417","\u6E29\u99A8\u63D0\u793A",{confirmButtonText:"\u786E\u5B9A",cancelButtonText:"\u53D6\u6D88",type:"info"}).then(async()=>{const a=e.selectionRows.length>0?e.selectionRows:e.ids,l={accessToken:sessionStorage.getItem("accessToken"),ids:a};S.postAdminExportLog(l).then(()=>{_({type:"success",message:"Excel \u6587\u4EF6\u6B63\u5728\u4E0B\u8F7D..."})}).catch(()=>{_({type:"error",message:"\u4E0B\u8F7D\u5931\u8D25\uFF0C\u8BF7\u91CD\u8BD5"})})}).catch(()=>{_({type:"info",message:"\u5DF2\u53D6\u6D88"})})},I=async()=>{T.confirm("\u786E\u5B9A\u8981\u4E0B\u8F7DPDF\u5417","\u6E29\u99A8\u63D0\u793A",{confirmButtonText:"\u786E\u5B9A",cancelButtonText:"\u53D6\u6D88",type:"info"}).then(async()=>{const a=e.selectionRows.length>0?e.selectionRows:e.ids,l={accessToken:sessionStorage.getItem("accessToken"),ids:a};S.postAdminPrintLog(l).then(()=>{_({type:"success",message:"PDF \u6587\u4EF6\u6B63\u5728\u4E0B\u8F7D..."})}).catch(()=>{_({type:"error",message:"\u4E0B\u8F7D\u5931\u8D25\uFF0C\u8BF7\u91CD\u8BD5"})})}).catch(()=>{_({type:"info",message:"\u5DF2\u53D6\u6D88"})})},$=async()=>{e.statistic_visible=!0};return ve(()=>e.searchKeyword,a=>{d()}),J(()=>{r(),u()}),v(B({},U(e)),{displayData:u,handleSelectionChange:c,onCurrentChange:D,onSizeChange:g,onDetail:m,useConfirmDelete:y,onDelete:k,onSearch:d,onExport:b,onPrint:I,onStatistic:$,fetchData:r,handleSortChange:t})}}),qe=h("\u6279\u91CF\u5220\u9664"),Je=h("\u5BFC\u51FA\u64CD\u4F5C\u65E5\u5FD7"),We=h("\u6253\u5370\u64CD\u4F5C\u65E5\u5FD7"),Ge=h("\u7EDF\u8BA1\u4FE1\u606F"),He=p("br",null,null,-1),Xe={class:"pagination"};function Ye(e,o,t,c,r,D){const g=i("delete"),m=i("el-icon"),u=i("el-button"),d=i("download"),y=i("printer"),k=i("odometer"),b=i("el-col"),I=i("el-input"),$=i("el-row"),a=i("el-table-column"),l=i("InfoFilled"),F=i("el-tooltip"),E=i("el-table"),H=i("el-pagination"),X=i("el-card"),Y=i("log-detail"),M=i("el-dialog"),Z=i("log-statistic"),ee=W("loading");return R(),j("div",null,[n(X,{class:"card-ctrl"},{default:s(()=>[n($,null,{default:s(()=>[n(b,{span:14,style:{"text-align":"left"}},{default:s(()=>[n(u,{type:"danger",size:"medium",onClick:e.onDelete},{default:s(()=>[n(m,null,{default:s(()=>[n(g)]),_:1}),qe]),_:1},8,["onClick"]),n(u,{type:"info",size:"medium",onClick:e.onExport},{default:s(()=>[n(m,null,{default:s(()=>[n(d)]),_:1}),Je]),_:1},8,["onClick"]),n(u,{type:"info",size:"medium",onClick:e.onPrint},{default:s(()=>[n(m,null,{default:s(()=>[n(y)]),_:1}),We]),_:1},8,["onClick"]),n(u,{type:"success",size:"medium",onClick:e.onStatistic},{default:s(()=>[n(m,null,{default:s(()=>[n(k)]),_:1}),Ge]),_:1},8,["onClick"])]),_:1}),n(b,{span:10,style:{"text-align":"right"}},{default:s(()=>[n(I,{modelValue:e.searchKeyword,"onUpdate:modelValue":o[0]||(o[0]=C=>e.searchKeyword=C),placeholder:"\u8BF7\u8F93\u5165\u5173\u952E\u8BCD",style:{width:"200px","margin-right":"10px"}},null,8,["modelValue"])]),_:1})]),_:1}),He,G((R(),Le(E,{data:e.displayData(),stripe:"",class:"table",onSelectionChange:e.handleSelectionChange},{default:s(()=>[n(a,{type:"selection",width:"55",align:"center",sortable:"",onSortChange:e.handleSortChange},null,8,["onSortChange"]),n(a,{prop:"id",label:"\u64CD\u4F5CID",align:"center",sortable:"",onSortChange:e.handleSortChange},null,8,["onSortChange"]),n(a,{prop:"userId",label:"\u7528\u6237ID",align:"center",sortable:"",onSortChange:e.handleSortChange},null,8,["onSortChange"]),n(a,{prop:"logContent",label:"\u64CD\u4F5C\u5185\u5BB9",align:"center",sortable:"",onSortChange:e.handleSortChange},null,8,["onSortChange"]),n(a,{prop:"logDate",label:"\u64CD\u4F5C\u65F6\u95F4",align:"center",sortable:"",onSortChange:e.handleSortChange},null,8,["onSortChange"]),n(a,{label:"\u64CD\u4F5C",align:"center"},{default:s(C=>[n(F,{class:"item",effect:"dark",content:"\u8BE6\u60C5",placement:"bottom"},{default:s(()=>[n(u,{circle:"",plain:"",type:"info",size:"small",onClick:Ze=>e.onDetail(C.$index,C.row)},{default:s(()=>[n(m,null,{default:s(()=>[n(l)]),_:1})]),_:2},1032,["onClick"])]),_:2},1024)]),_:1})]),_:1},8,["data","onSelectionChange"])),[[ee,e.loading]]),p("div",Xe,[n(H,{"current-page":e.param.page,"page-size":e.param.size,layout:"sizes,prev,pager,next,total","page-sizes":[10,20,50,100],total:e.param.total,background:"",onCurrentChange:e.onCurrentChange,onSizeChange:e.onSizeChange},null,8,["current-page","page-size","total","onCurrentChange","onSizeChange"])])]),_:1}),n(M,{modelValue:e.detail_visible,"onUpdate:modelValue":o[1]||(o[1]=C=>e.detail_visible=C),center:"",title:"\u65E5\u5FD7\u4FE1\u606F\u8BE6\u60C5"},{default:s(()=>[n(Y,{"current-row":e.posted.logRow},null,8,["current-row"])]),_:1},8,["modelValue"]),n(M,{modelValue:e.statistic_visible,"onUpdate:modelValue":o[2]||(o[2]=C=>e.statistic_visible=C),center:"",title:"\u7EDF\u8BA1\u4FE1\u606F"},{default:s(()=>[n(Z,{data:e.data},null,8,["data"])]),_:1},8,["modelValue"])])}var nt=P(Ne,[["render",Ye]]);export{nt as default};
