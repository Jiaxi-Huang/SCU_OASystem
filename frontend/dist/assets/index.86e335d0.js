var se=Object.defineProperty,oe=Object.defineProperties;var te=Object.getOwnPropertyDescriptors;var K=Object.getOwnPropertySymbols;var ue=Object.prototype.hasOwnProperty,re=Object.prototype.propertyIsEnumerable;var W=(e,s,o)=>s in e?se(e,s,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[s]=o,O=(e,s)=>{for(var o in s||(s={}))ue.call(s,o)&&W(e,o,s[o]);if(K)for(var o of K(s))re.call(s,o)&&W(e,o,s[o]);return e},z=(e,s)=>oe(e,te(s));import{Q as ae}from"./qrcode.vue.esm.36b9f92c.js";import{e as N,j as ne,u as le,r as P,B as X,D as Y,E as F,m as C,f as y,g as L,q as A,s as a,t as u,i as r,S as T,Q as E,y as Z,p as Q,h as H}from"./vendor.e05abf4c.js";import{e as G}from"./aes.35bb7e4b.js";import{r as $,u as ie,_ as J}from"./index.63817855.js";var de="/vue3.0-template-admin/assets/logo-vite.63a26457.svg",pe="/vue3.0-template-admin/assets/logo.03d6d6da.png",me="/vue3.0-template-admin/assets/woking.7b0eaf73.gif";const w={baseURL:"http://127.0.0.1:8080/api",userLogin:"/auth/user/login",userRegister:"/auth/user/register",sendCaptcha:"/auth/email/sendCaptcha",forgetPassword:"/auth/email/forgot-password",resetPassword:"/auth/user/reset-password",permissionRoutes:"/auth/permission/routes",userInfo:"/auth/user/userInfo"};class R{static postLogin(s){return $({url:w.baseURL+w.userLogin,method:"POST",json:!0,data:s}).then(o=>o.status===0?Promise.resolve(o):Promise.reject(o))}static postRegister(s){return $({url:w.baseURL+w.userRegister,method:"POST",json:!0,data:s}).then(o=>o.status===0?Promise.resolve(o):Promise.reject(o))}static postCaptcha(s){return $({url:w.baseURL+w.sendCaptcha,method:"POST",json:!0,data:s}).then(o=>o.status===0?Promise.resolve(o):Promise.reject(o))}static postResetPwd(s){return $({url:w.baseURL+w.resetPassword,method:"POST",json:!0,data:s}).then(o=>o.status===0?Promise.resolve(o):Promise.reject(o))}static postAuthPermission(s){return $({url:w.baseURL+w.permissionRoutes,method:"POST",json:!0,data:s}).then(o=>(console.log(o),o.status===0?Promise.resolve(o):Promise.reject(o)))}static postAuthUserInfo(s){return $({url:w.baseURL+w.userInfo,method:"POST",json:!0,data:s}).then(o=>o.status===0?Promise.resolve(o):Promise.reject(o))}}const ce=N({name:"LoginForm",emits:["toResetPwd"],setup(e,{emit:s}){const o=ne(),B=le(),_=P(),v=P(),l=ie(),n=P(!1),d=P("\u83B7\u53D6\u9A8C\u8BC1\u7801"),p=X({loginForm:{email:"",password:""},registerForm:{email:"",captcha:null,password:"",checkPass:""},showLogin:!0}),I={password:[{validator:(i,m,c)=>{m===""?c(new Error("\u8BF7\u8F93\u5165\u5BC6\u7801")):(p.registerForm.checkPass!==""&&v.value.validateField("checkPass"),c())},trigger:"blur"},{min:6,max:10,message:"\u957F\u5EA6\u5728 6 \u5230 10 \u4E2A\u5B57\u7B26",trigger:"blur"}],checkPass:[{validator:(i,m,c)=>{m===""?c(new Error("\u8BF7\u518D\u6B21\u8F93\u5165\u5BC6\u7801")):m!==p.registerForm.password?c(new Error("\u4E24\u6B21\u8F93\u5165\u5BC6\u7801\u4E0D\u4E00\u81F4!")):c()},trigger:"blur"}],email:[{required:!0,message:"\u8BF7\u8F93\u5165\u6CE8\u518C\u90AE\u7BB1",trigger:"change"},{type:"email",message:"\u8BF7\u8F93\u5165\u6B63\u786E\u7684\u90AE\u7BB1\u5730\u5740",trigger:["blur","change"]}],captcha:[{required:!0,message:"\u8BF7\u8F93\u5165\u9A8C\u8BC1\u7801",trigger:"blur"}]},g=()=>{_.value.validate(async i=>{var m,c;if(i)try{const{email:k,password:q}=p.loginForm,b={email:k,password:G(q)},j=await R.postLogin(b),M=(c=(m=j==null?void 0:j.data)==null?void 0:m.accessToken)!=null?c:null;if(M){const V=await R.postAuthUserInfo({accessToken:M});if(V.status===0&&(l.dispatch("permissionModule/getPermissonRoles",V.data),l.dispatch("permissionModule/getUserInfos",V.data)),l.dispatch("permissionModule/getPermissonRoutes",V.data),l.dispatch("permissionModule/getPermissions"),sessionStorage.setItem("auth","true"),sessionStorage.setItem("accessToken",M),B.query.redirect){const ee=B.query.redirect;o.push({path:ee})}else o.push("/")}else F({type:"warning",message:"\u8D26\u53F7\u6216\u8005\u5BC6\u7801\u6709\u8BEF"})}catch(k){F({type:"warning",message:k.message})}return!1})},f=()=>{v.value.validate(async i=>{if(i)try{const{email:m,password:c,captcha:k}=p.registerForm,q={email:m,captcha:k,password:G(c)};R.postRegister(q).then(b=>{b.status===0?(F({type:"success",message:"\u6CE8\u518C\u6210\u529F"}),p.showLogin=!0):F({type:"warning",message:b.message})}).catch(b=>{F({type:"warning",message:b.message})})}catch(m){F({type:"error",message:m.message})}})},h=()=>{let i=60;n.value=!0;const m=setInterval(()=>{i>0?(d.value=`\u5DF2\u53D1\u9001(${i}s)`,i-=1):(clearInterval(m),n.value=!1,d.value="\u83B7\u53D6\u9A8C\u8BC1\u7801")},1e3)},U=async()=>{try{const{email:i}=p.registerForm;if(!i)return F({type:"warning",message:"\u8BF7\u8F93\u5165\u6CE8\u518C\u90AE\u7BB1"}),!1;const m={email:i},c=await R.postCaptcha(m);return c.status===0?(F({type:"success",message:c.message}),h(),!0):(F({type:"warning",message:c.message}),!1)}catch(i){return console.error(i),!1}},S=()=>{s("toResetPwd")};return z(O({},Y(p)),{loginFormRef:_,registerRef:v,sendingCode:n,codeText:d,rules:I,submitForm:g,handleRegister:f,handleGetCaptcha:U,handleForget:S})}}),ge=e=>(Q("data-v-293284e2"),e=e(),H(),e),fe={class:"form-container"},he={class:"btn-container"},Fe=E("\u767B\u5F55"),Be={class:"operation"},ve={class:"btn-container"},we=E("\u5B8C\u6210\u6CE8\u518C"),Ce={class:"go-login"},_e=E("\u5DF2\u6709\u8D26\u53F7"),ye=ge(()=>r("em",null,"\u53BB\u767B\u9646",-1)),Pe=[_e,ye];function Ee(e,s,o,B,_,v){const l=C("el-input"),n=C("el-form-item"),d=C("el-button"),p=C("el-form");return y(),L("div",fe,[e.showLogin?(y(),A(p,{key:0,ref:"loginFormRef",model:e.loginForm,"status-icon":"","hide-required-asterisk":!0,rules:e.rules,"label-width":"100px",class:"login-form"},{default:a(()=>[u(n,{label:"\u8D26\u53F7",prop:"email"},{default:a(()=>[u(l,{modelValue:e.loginForm.email,"onUpdate:modelValue":s[0]||(s[0]=t=>e.loginForm.email=t),autocomplete:"off",placeholder:"\u8BF7\u8F93\u5165\u767B\u5F55\u90AE\u7BB1(super@outlook.com)"},null,8,["modelValue"])]),_:1}),u(n,{label:"\u5BC6\u7801",prop:"password"},{default:a(()=>[u(l,{modelValue:e.loginForm.password,"onUpdate:modelValue":s[1]||(s[1]=t=>e.loginForm.password=t),type:"password",autocomplete:"off",placeholder:"\u8BF7\u8F93\u5165\u5BC6\u7801(123456)"},null,8,["modelValue"])]),_:1}),u(n,null,{default:a(()=>[r("div",he,[u(d,{type:"primary",style:{width:"100%"},onClick:s[2]||(s[2]=t=>e.submitForm())},{default:a(()=>[Fe]),_:1})]),r("div",Be,[r("span",{class:"free-register",onClick:s[3]||(s[3]=t=>e.showLogin=!e.showLogin)},"\u514D\u8D39\u6CE8\u518C"),r("span",{class:"forget-password",onClick:s[4]||(s[4]=(...t)=>e.handleForget&&e.handleForget(...t))},"\u5FD8\u8BB0\u5BC6\u7801")])]),_:1})]),_:1},8,["model","rules"])):T("",!0),e.showLogin?T("",!0):(y(),A(p,{key:1,ref:"registerRef",model:e.registerForm,"status-icon":"","hide-required-asterisk":!0,rules:e.rules,"label-width":"100px",class:"login-form"},{default:a(()=>[u(n,{label:"\u90AE\u7BB1",prop:"email"},{default:a(()=>[u(l,{modelValue:e.registerForm.email,"onUpdate:modelValue":s[5]||(s[5]=t=>e.registerForm.email=t),autocomplete:"off",placeholder:"\u8BF7\u8F93\u5165\u6CE8\u518C\u90AE\u7BB1"},{append:a(()=>[u(d,{disabled:e.sendingCode,onClick:e.handleGetCaptcha},{default:a(()=>[E(Z(e.codeText),1)]),_:1},8,["disabled","onClick"])]),_:1},8,["modelValue"])]),_:1}),u(n,{label:"\u9A8C\u8BC1\u7801",prop:"captcha"},{default:a(()=>[u(l,{modelValue:e.registerForm.captcha,"onUpdate:modelValue":s[6]||(s[6]=t=>e.registerForm.captcha=t),modelModifiers:{number:!0},maxlength:"10",autocomplete:"off",placeholder:"\u8BF7\u8F93\u5165\u9A8C\u8BC1\u7801"},null,8,["modelValue"])]),_:1}),u(n,{label:"\u5BC6\u7801",prop:"password"},{default:a(()=>[u(l,{modelValue:e.registerForm.password,"onUpdate:modelValue":s[7]||(s[7]=t=>e.registerForm.password=t),type:"password",autocomplete:"off",placeholder:"\u8BF7\u8F93\u5165\u5BC6\u7801"},null,8,["modelValue"])]),_:1}),u(n,{label:"\u786E\u8BA4\u5BC6\u7801",prop:"checkPass"},{default:a(()=>[u(l,{modelValue:e.registerForm.checkPass,"onUpdate:modelValue":s[8]||(s[8]=t=>e.registerForm.checkPass=t),type:"password",autocomplete:"off"},null,8,["modelValue"])]),_:1}),u(n,null,{default:a(()=>[r("div",ve,[u(d,{type:"primary",style:{width:"100%"},onClick:s[9]||(s[9]=t=>e.handleRegister())},{default:a(()=>[we]),_:1})]),r("div",Ce,[r("span",{class:"to-login",onClick:s[10]||(s[10]=t=>e.showLogin=!e.showLogin)},Pe)])]),_:1})]),_:1},8,["model","rules"]))])}var be=J(ce,[["render",Ee],["__scopeId","data-v-293284e2"]]);const $e=N({name:"ForgetPassword",props:{showReset:{type:Boolean,default:!1}},emits:["toLogin"],setup(e,{emit:s}){const o=P(),B=X({resetForm:{email:"",captcha:null,password:"",checkPass:""}}),_=P(!1),v=P("\u83B7\u53D6\u9A8C\u8BC1\u7801"),l=()=>{s("toLogin")},n=()=>{let g=60;_.value=!0;const f=setInterval(()=>{g>0?(v.value=`\u5DF2\u53D1\u9001(${g}s)`,g-=1):(clearInterval(f),_.value=!1,v.value="\u83B7\u53D6\u9A8C\u8BC1\u7801")},1e3)},d=async()=>{try{const{email:g}=B.resetForm;if(!g)return F({type:"warning",message:"\u8BF7\u8F93\u5165\u6CE8\u518C\u90AE\u7BB1"}),!1;const f={email:g},h=await R.postCaptcha(f);return h.status===0?(F({type:"success",message:h.message}),n(),!0):(F({type:"warning",message:h.message}),!1)}catch(g){return console.error(g),!1}},p=async()=>{o.value.validate(async g=>{if(g)try{const{email:f,password:h,captcha:U}=B.resetForm,S={email:f,password:G(h),captcha:U},i=await R.postResetPwd(S);i.status===0?(F({type:"warning",message:i.message}),s("toLogin")):F({type:"success",message:i.message})}catch(f){console.error(f)}return!1})},I={password:[{validator:(g,f,h)=>{f===""?h(new Error("\u8BF7\u8F93\u5165\u5BC6\u7801")):(B.resetForm.checkPass!==""&&o.value.validateField("checkPass"),h())},trigger:"blur"},{min:6,max:10,message:"\u957F\u5EA6\u5728 6 \u5230 10 \u4E2A\u5B57\u7B26",trigger:"blur"}],checkPass:[{validator:(g,f,h)=>{f===""?h(new Error("\u8BF7\u518D\u6B21\u8F93\u5165\u5BC6\u7801")):f!==B.resetForm.password?h(new Error("\u4E24\u6B21\u8F93\u5165\u5BC6\u7801\u4E0D\u4E00\u81F4!")):h()},trigger:"blur"}],email:[{required:!0,message:"\u8BF7\u8F93\u5165\u6CE8\u518C\u90AE\u7BB1",trigger:"change"},{type:"email",message:"\u8BF7\u8F93\u5165\u6B63\u786E\u7684\u90AE\u7BB1\u5730\u5740",trigger:["blur","change"]}],captcha:[{required:!0,message:"\u8BF7\u8F93\u5165\u9A8C\u8BC1\u7801",trigger:"blur"}]};return z(O({},Y(B)),{rules:I,sendingCode:_,codeText:v,resetRef:o,handleGetCaptcha:d,handleToLogin:l,handleResetPwd:p})}}),Re=e=>(Q("data-v-d28c1bdc"),e=e(),H(),e),ke={class:"form-container"},Le={class:"btn-container"},Ae=E("\u786E\u8BA4\u91CD\u7F6E"),Ve={class:"go-login"},Te=Re(()=>r("em",null,"\u53BB\u767B\u9646",-1)),De=[Te];function Ie(e,s,o,B,_,v){const l=C("el-button"),n=C("el-input"),d=C("el-form-item"),p=C("el-form");return y(),L("div",ke,[e.showReset?(y(),A(p,{key:0,ref:"resetRef",model:e.resetForm,"status-icon":"","hide-required-asterisk":!0,rules:e.rules,"label-width":"100px",class:"login-form"},{default:a(()=>[u(d,{label:"\u90AE\u7BB1",prop:"email"},{default:a(()=>[u(n,{modelValue:e.resetForm.email,"onUpdate:modelValue":s[0]||(s[0]=t=>e.resetForm.email=t),autocomplete:"off",placeholder:"\u8BF7\u8F93\u5165\u90AE\u7BB1"},{append:a(()=>[u(l,{disabled:e.sendingCode,onClick:e.handleGetCaptcha},{default:a(()=>[E(Z(e.codeText),1)]),_:1},8,["disabled","onClick"])]),_:1},8,["modelValue"])]),_:1}),u(d,{label:"\u9A8C\u8BC1\u7801",prop:"captcha"},{default:a(()=>[u(n,{modelValue:e.resetForm.captcha,"onUpdate:modelValue":s[1]||(s[1]=t=>e.resetForm.captcha=t),modelModifiers:{number:!0},maxlength:"6",autocomplete:"off",placeholder:"\u8BF7\u8F93\u5165\u9A8C\u8BC1\u7801"},null,8,["modelValue"])]),_:1}),u(d,{label:"\u5BC6\u7801",prop:"password"},{default:a(()=>[u(n,{modelValue:e.resetForm.password,"onUpdate:modelValue":s[2]||(s[2]=t=>e.resetForm.password=t),type:"password",autocomplete:"off",placeholder:"\u8BF7\u8F93\u5165\u5BC6\u7801"},null,8,["modelValue"])]),_:1}),u(d,{label:"\u786E\u8BA4\u5BC6\u7801",prop:"checkPass"},{default:a(()=>[u(n,{modelValue:e.resetForm.checkPass,"onUpdate:modelValue":s[3]||(s[3]=t=>e.resetForm.checkPass=t),type:"password",autocomplete:"off"},null,8,["modelValue"])]),_:1}),u(d,null,{default:a(()=>[r("div",Le,[u(l,{type:"primary",style:{width:"100%"},onClick:s[4]||(s[4]=t=>e.handleResetPwd())},{default:a(()=>[Ae]),_:1})]),r("div",Ve,[r("span",{class:"to-login",onClick:s[5]||(s[5]=(...t)=>e.handleToLogin&&e.handleToLogin(...t))},De)])]),_:1})]),_:1},8,["model","rules"])):T("",!0)])}var Ue=J($e,[["render",Ie],["__scopeId","data-v-d28c1bdc"]]);const Se=N({name:"Index",components:{QrcodeVue:ae,Login:be,ForgetPassword:Ue},data(){return{value:"http://localhost:8080/api/auth/wechat/login",size:100}},setup(){const e=P("account"),s=P(!1);return{loginType:e,selectLoginType:v=>{e.value=v},showReset:s,handleResetPwd:()=>{s.value=!0},handleToLogin:()=>{s.value=!1},vueLogo:pe,working:me,viteLogo:de}}}),D=e=>(Q("data-v-91da50b0"),e=e(),H(),e),qe={class:"container"},je={class:"login-container"},Me={class:"login-left"},Oe=D(()=>r("div",{class:"top"},[r("div",{class:"title"},[r("span",null,"\u6B22\u8FCE\u4F7F\u7528")]),r("div",{class:"desc"},[r("span",null,"SCU_OA\u529E\u516C\u7BA1\u7406\u7CFB\u7EDF\uFF01")])],-1)),ze={class:"bottom"},Ge=["src"],Ne={class:"login-right"},Qe={class:"login-box"},He={class:"login-options"},Je=E("\u8D26\u53F7\u767B\u5F55"),Ke=E("\u4E8C\u7EF4\u7801\u767B\u5F55"),We={class:"login-content"},Xe={key:0},Ye=D(()=>r("span",null,"\u8BF7\u4F7F\u7528\u5FAE\u4FE1\u626B\u63CF\u4E8C\u7EF4\u7801\u767B\u5F55",-1)),Ze=D(()=>r("br",null,null,-1)),xe=D(()=>r("div",{id:"wechat-login"},null,-1)),es={key:1};function ss(e,s,o,B,_,v){const l=C("el-button"),n=C("qrcode-vue"),d=C("Login"),p=C("ForgetPassword");return y(),L("div",qe,[r("div",je,[r("div",Me,[Oe,r("div",ze,[r("img",{src:e.working},null,8,Ge)])]),r("div",Ne,[r("div",Qe,[r("div",He,[u(l,{type:"primary",onClick:s[0]||(s[0]=t=>e.selectLoginType("account"))},{default:a(()=>[Je]),_:1}),u(l,{type:"primary",onClick:s[1]||(s[1]=t=>e.selectLoginType("qr"))},{default:a(()=>[Ke]),_:1})]),r("div",We,[e.loginType==="qr"?(y(),L("div",Xe,[Ye,Ze,u(n,{value:e.value,size:e.size,level:"H"},null,8,["value","size"]),xe])):e.loginType==="account"?(y(),L("div",es,[e.showReset?(y(),A(p,{key:1,"show-reset":e.showReset,onToLogin:e.handleToLogin},null,8,["show-reset","onToLogin"])):(y(),A(d,{key:0,onToResetPwd:e.handleResetPwd},null,8,["onToResetPwd"]))])):T("",!0)])])])])])}var ns=J(Se,[["render",ss],["__scopeId","data-v-91da50b0"]]);export{ns as default};
