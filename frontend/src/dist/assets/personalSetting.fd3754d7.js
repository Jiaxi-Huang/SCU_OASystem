var Y=Object.defineProperty,Z=Object.defineProperties;var x=Object.getOwnPropertyDescriptors;var O=Object.getOwnPropertySymbols;var ee=Object.prototype.hasOwnProperty,se=Object.prototype.propertyIsEnumerable;var Q=(e,s,t)=>s in e?Y(e,s,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[s]=t,D=(e,s)=>{for(var t in s||(s={}))ee.call(s,t)&&Q(e,t,s[t]);if(O)for(var t of O(s))se.call(s,t)&&Q(e,t,s[t]);return e},G=(e,s)=>Z(e,x(s));import{e as U,r as w,B as P,E as _,m as n,f as I,q as J,s as a,t as o,Q as C,y as K,p as R,h as j,i as u,j as W,k as oe,c as ue,D as te,g as ae}from"./vendor.e05abf4c.js";import{r as S,u as X,_ as T}from"./index.63817855.js";import{e as H}from"./aes.35bb7e4b.js";const h={baseURL:"http://127.0.0.1:8080/api",basicInfo:"/api/setting/basicInfo",postSetEmail:"/setting/resetEmail",postCaptcha:"/setting/email/sendCaptcha",postSetPassword:"/setting/resetPassword"};class V{static postSetBasicInfo(s){return S({url:h.baseURL+h.basicInfo,method:"post",json:!0,data:s}).then(t=>t.status===0?Promise.resolve(t):Promise.reject(t))}static postSetEmail(s){return S({url:h.baseURL+h.postSetEmail,method:"post",json:!0,data:s}).then(t=>t.status===0?Promise.resolve(t):Promise.reject(t))}static postCaptcha(s){return S({url:h.baseURL+h.postCaptcha,method:"POST",json:!0,data:s}).then(t=>t.status===0?Promise.resolve(t):Promise.reject(t))}static postSetPassword(s){return S({url:h.baseURL+h.postSetPassword,method:"post",json:!0,data:s}).then(t=>t.status===0?Promise.resolve(t):Promise.reject(t))}}const le=U({name:"PersonalEmailEdit",emits:["success"],setup(e,{emit:s}){w();const t=X(),f=w(!1),g=w("\u83B7\u53D6\u9A8C\u8BC1\u7801"),B={oldEmail:[{required:!0,type:"email",message:"\u8BF7\u8F93\u5165\u90AE\u7BB1",trigger:"change"}],newEmail:[{required:!0,type:"email",message:"\u8BF7\u8F93\u5165\u90AE\u7BB1",trigger:"change"}]},r=P({oldEmail:"",newEmail:"",captcha:null,accessToken:sessionStorage.getItem("accessToken")}),i=async()=>{const c={email:r.newEmail},l=await V.postCaptcha(c);return l.status===0?(_({type:"success",message:l.message}),d(),!0):(_({type:"warning",message:l.message}),!1)},d=()=>{let c=60;f.value=!0;const l=setInterval(()=>{c>0?(g.value=`\u5DF2\u53D1\u9001(${c}s)`,c-=1):(clearInterval(l),f.value=!1,g.value="\u83B7\u53D6\u9A8C\u8BC1\u7801")},1e3)};return{rules:B,sendingCode:f,codeText:g,resetEmailForm:r,sendCaptcha:i,getCodeSuccess:d,submitResetEmailForm:async()=>{const c=D({},r),l=await V.postSetEmail(c);console.log(l),l.status===0?(t.dispatch("permissionModule/getUserInfos",l.data),_({type:"success",message:l.message}),s("success")):_({type:"error",message:l.message})}}}}),ne=e=>(R("data-v-8d7c0b0e"),e=e(),j(),e),re=ne(()=>u("i",{class:"fa fa-plus"},null,-1)),ie=C(" \u4FEE\u6539 ");function de(e,s,t,f,g,B){const r=n("el-input"),i=n("el-form-item"),d=n("el-button"),E=n("el-row"),c=n("el-form");return I(),J(c,{ref:"settingEmailFormRef",model:e.resetEmailForm,rules:e.rules,"label-position":"right","label-width":"100px",title:"\u4FEE\u6539\u7ED1\u5B9A\u90AE\u7BB1"},{default:a(()=>[o(i,{label:"\u539F\u7ED1\u5B9A\u90AE\u7BB1",prop:"oldEmail"},{default:a(()=>[o(r,{modelValue:e.resetEmailForm.oldEmail,"onUpdate:modelValue":s[0]||(s[0]=l=>e.resetEmailForm.oldEmail=l),type:"email",placeholder:"\u65E7\u7684\u90AE\u7BB1"},null,8,["modelValue"])]),_:1}),o(i,{label:"\u65B0\u7ED1\u5B9A\u90AE\u7BB1",prop:"newEmail"},{default:a(()=>[o(r,{modelValue:e.resetEmailForm.newEmail,"onUpdate:modelValue":s[1]||(s[1]=l=>e.resetEmailForm.newEmail=l),type:"email",placeholder:"\u65B0\u7684\u90AE\u7BB1"},null,8,["modelValue"]),o(d,{type:"primary",disabled:e.sendingCode,onClick:e.sendCaptcha},{default:a(()=>[C(K(e.codeText),1)]),_:1},8,["disabled","onClick"])]),_:1}),o(i,{label:"\u9A8C\u8BC1\u7801",prop:"captcha"},{default:a(()=>[o(r,{modelValue:e.resetEmailForm.captcha,"onUpdate:modelValue":s[2]||(s[2]=l=>e.resetEmailForm.captcha=l),modelModifiers:{number:!0},maxlength:"6",autocomplete:"off",placeholder:"\u65B0\u90AE\u7BB1\u9A8C\u8BC1\u7801"},null,8,["modelValue"])]),_:1}),o(E,{class:"btn-container"},{default:a(()=>[o(d,{size:"mini",type:"primary",onClick:s[3]||(s[3]=l=>e.submitResetEmailForm())},{default:a(()=>[re,ie]),_:1})]),_:1})]),_:1},8,["model","rules"])}var ce=T(le,[["render",de],["__scopeId","data-v-8d7c0b0e"]]);const me=U({name:"PersonalPasswordEdit",emits:["success"],setup(e,{emit:s}){W(),w();const t=P({oldPassword:"",newPassword:"",confirmNewPassword:""}),f=(r,i,d)=>{i!==t.newPassword?d(new Error("\u4E24\u6B21\u8F93\u5165\u7684\u5BC6\u7801\u4E0D\u4E00\u81F4")):d()};return{rules:{oldPassword:[{required:!0,type:"password",message:"\u8BF7\u8F93\u5165\u5BC6\u7801",trigger:"change"}],newPassword:[{required:!0,type:"password",message:"\u8BF7\u8F93\u5165\u5BC6\u7801",trigger:"change"},{min:6,max:20,message:"\u957F\u5EA6\u5728 6 \u5230 20 \u4E2A\u5B57\u7B26",trigger:"change"}],confirmNewPassword:[{required:!0,message:"\u8BF7\u518D\u6B21\u8F93\u5165\u65B0\u5BC6\u7801",trigger:"change"},{validator:f,trigger:"change"}]},validateConfirmPassword:f,resetPasswordForm:t,submitResetPasswordForm:async()=>{const{oldPassword:r,newPassword:i}=t,d={oldPassword:H(r),newPassword:H(i),accessToken:sessionStorage.getItem("accessToken")},E=await V.postSetPassword(d);console.log(E),E.status===0?(_({type:"success",message:E.message}),s("success")):_({type:"error",message:E.message})}}}}),pe=e=>(R("data-v-b13f893e"),e=e(),j(),e),Ee=pe(()=>u("i",{class:"fa fa-plus"},null,-1)),Fe=C(" \u4FEE\u6539 ");function fe(e,s,t,f,g,B){const r=n("el-input"),i=n("el-form-item"),d=n("el-button"),E=n("el-row"),c=n("el-form");return I(),J(c,{ref:"settingPasswordFormRef",model:e.resetPasswordForm,rules:e.rules,"label-position":"right","label-width":"100px",title:"\u4FEE\u6539\u7ED1\u5B9A\u90AE\u7BB1"},{default:a(()=>[o(i,{label:"\u539F\u5BC6\u7801",prop:"oldPassword"},{default:a(()=>[o(r,{modelValue:e.resetPasswordForm.oldPassword,"onUpdate:modelValue":s[0]||(s[0]=l=>e.resetPasswordForm.oldPassword=l),type:"password",placeholder:"\u65E7\u7684\u5BC6\u7801"},null,8,["modelValue"])]),_:1}),o(i,{label:"\u65B0\u5BC6\u7801",prop:"newPassword"},{default:a(()=>[o(r,{modelValue:e.resetPasswordForm.newPassword,"onUpdate:modelValue":s[1]||(s[1]=l=>e.resetPasswordForm.newPassword=l),type:"password",placeholder:"\u65B0\u7684\u5BC6\u7801"},null,8,["modelValue"])]),_:1}),o(i,{label:"\u65B0\u5BC6\u7801\u9A8C\u8BC1",prop:"confirmNewPassword"},{default:a(()=>[o(r,{modelValue:e.resetPasswordForm.confirmNewPassword,"onUpdate:modelValue":s[2]||(s[2]=l=>e.resetPasswordForm.confirmNewPassword=l),type:"password",placeholder:"\u518D\u6B21\u8F93\u5165\u65B0\u7684\u5BC6\u7801"},null,8,["modelValue"])]),_:1}),o(E,{class:"btn-container"},{default:a(()=>[o(d,{size:"mini",type:"primary",onClick:s[3]||(s[3]=l=>e.submitResetPasswordForm())},{default:a(()=>[Ee,Fe]),_:1})]),_:1})]),_:1},8,["model","rules"])}var _e=T(me,[["render",fe],["__scopeId","data-v-b13f893e"]]);const ge=U({name:"PersonalSetting",components:{PersonalEmailEdit:ce,PersonalPasswordEdit:_e},setup(){let e=localStorage.getItem("email");const s=W(),t=w("left"),f=w(),g=X(),B=w(!1),r=w(!1),i=oe(()=>g.state.permissionModule.avatar),d=P({userSwitch:!1,sysSwitch:!0,taskSwitch:!0}),E=P({username:"",intro:"",phone:"",accessToken:sessionStorage.getItem("accessToken")}),c=w(!1),l=P({accessToken:`${E.accessToken}`}),A=m=>m||"src/assets/avatar-default.jpg",k={username:{required:!0,message:"\u8BF7\u8F93\u5165\u6635\u79F0",trigger:["blur","change"]},intro:{required:!0,message:"\u8BF7\u8F93\u5165\u4E2A\u4EBA\u7B80\u4ECB",trigger:["blur","change"]},phone:{required:!0,validator:(m,v,b)=>{v===""?b(new Error("\u624B\u673A\u53F7\u7801\u4E0D\u53EF\u4E3A\u7A7A\u54E6")):/^1[3-9]\d{9}$/.test(v)?b():b(new Error("\u8BF7\u8F93\u5165\u6B63\u786E\u7684\u624B\u673A\u53F7\u7801"))},trigger:["blur","change"]}};return ue(()=>{}),G(D({email:e,avatar:i,additionalParams:l,getAvatarUrl:A,handleBack:()=>{s.go(-1)},tabPosition:t,settingFormRef:f,settingForm:E,submitForm:()=>{f.value.validate(async m=>{if(m){try{c.value=!0;const v=D({},E),b=await V.postSetBasicInfo(v);console.log(b),g.dispatch("permissionModule/getUserInfos",b.data),c.value=!1,_({type:"success",message:b.data.message})}catch(v){console.error(v)}return!0}return!1})},resetForm:()=>{f.value.resetFields()},handleAvatarSuccess:async m=>{m.status===0?(_("\u4E0A\u4F20\u5934\u50CF\u6210\u529F"),console.log(m.data[0]),g.dispatch("permissionModule/getUserInfos",m.data[0])):_.error("\u4E0A\u4F20\u5934\u50CF\u5931\u8D25: "+m.message)},beforeAvatarUpload:m=>{if(!/(gif|png|jpg|jpeg)$/i.test(m.type))return _({message:"\u4E0A\u4F20\u5934\u50CF\u56FE\u7247\u53EA\u80FD\u662Fgif|png|jpg|jpeg \u683C\u5F0F!",type:"warning"}),!1;const v=m.size/1024/1024<2;return v||_.error("\u4E0A\u4F20\u5934\u50CF\u56FE\u7247\u5927\u5C0F\u4E0D\u80FD\u8D85\u8FC7 2MB!"),v},showEmailDialog:B,showPasswordDialog:r,handleClose:m=>{B.value=!1,r.value=!1,m()},handleSaveEmail:m=>{_({type:"success",message:"\u90AE\u7BB1\u4FEE\u6539\u6210\u529F"}),B.value=!1},handleSavePassword:m=>{_({type:"success",message:"\u5BC6\u7801\u4FEE\u6539\u6210\u529F"}),r.value=!1},rules:k},te(d)),{updateLoading:c})}}),F=e=>(R("data-v-7ee9d334"),e=e(),j(),e),Be={class:"PersonalSetting"},ve={class:"grid-content bg-purple-dark"},we={class:"card-header"},he=F(()=>u("i",{class:"el-icon-arrow-left"},null,-1)),be=C("\u8FD4\u56DE"),Ce=F(()=>u("span",null,"\u4E2A\u4EBA\u8BBE\u7F6E",-1)),Ae=F(()=>u("div",null,null,-1)),Pe=F(()=>u("div",{class:"set-title"},[u("span",null,"\u57FA\u672C\u8BBE\u7F6E")],-1)),ye={class:"set-info"},De={class:"form-info"},Se=C("\u66F4\u65B0\u57FA\u672C\u4FE1\u606F"),Ve=C("\u91CD\u7F6E"),ke={class:"avatar"},$e={class:"preview"},Ue=F(()=>u("span",null,"\u5934\u50CF",-1)),Ie=["src"],Re=C("\u70B9\u51FB\u4E0A\u4F20"),je=F(()=>u("div",{class:"set-title"},[u("span",null,"\u5B89\u5168\u8BBE\u7F6E")],-1)),Te={class:"secure-item"},Me=F(()=>u("div",{class:"secure-info"},[u("span",{class:"secure-key"},"\u8D26\u6237\u5BC6\u7801")],-1)),qe=F(()=>u("span",null,"\u4FEE\u6539",-1)),Le=[qe],Ne={class:"secure-item"},ze={class:"secure-info"},Oe=F(()=>u("span",{class:"secure-key"},"\u7ED1\u5B9A\u90AE\u7BB1",-1)),Qe={class:"secure-value"},Ge=F(()=>u("span",null,"\u4FEE\u6539",-1)),He=[Ge],Je=F(()=>u("div",{class:"set-title"},[u("span",null,"\u65B0\u6D88\u606F\u901A\u77E5")],-1)),Ke={class:"secure-item"},We=F(()=>u("div",{class:"secure-info"},[u("span",{class:"secure-key"},"\u8D26\u6237\u5BC6\u7801"),u("span",{class:"secure-value"},"\u7528\u6237\u4FE1\u606F\u5C06\u4EE5\u7CFB\u7EDF\u5185\u90E8\u6E20\u9053\u901A\u77E5")],-1)),Xe={class:"secure-item"},Ye=F(()=>u("div",{class:"secure-info"},[u("span",{class:"secure-key"},"\u7CFB\u7EDF\u6D88\u606F"),u("span",{class:"secure-value"},"\u7CFB\u7EDF\u6D88\u606F\u5C06\u4EE5\u7CFB\u7EDF\u5185\u90E8\u6E20\u9053\u901A\u77E5")],-1)),Ze={class:"secure-item"},xe=F(()=>u("div",{class:"secure-info"},[u("span",{class:"secure-key"},"\u4EE3\u529E\u4EFB\u52A1"),u("span",{class:"secure-value"},"\u4EE3\u529E\u4EFB\u52A1\u5C06\u4EE5\u7CFB\u7EDF\u5185\u90E8\u6E20\u9053\u901A\u77E5")],-1));function es(e,s,t,f,g,B){const r=n("el-button"),i=n("el-input"),d=n("el-form-item"),E=n("el-form"),c=n("el-upload"),l=n("el-tab-pane"),A=n("el-switch"),y=n("el-tooltip"),k=n("el-tabs"),M=n("el-card"),q=n("el-col"),L=n("el-row"),N=n("personal-email-edit"),$=n("el-dialog"),z=n("personal-password-edit");return I(),ae("div",Be,[o(L,null,{default:a(()=>[o(q,{offset:1,span:22},{default:a(()=>[u("div",ve,[o(M,{class:"box-card"},{header:a(()=>[u("div",we,[o(r,{class:"button",type:"text",onClick:e.handleBack},{default:a(()=>[he,be]),_:1},8,["onClick"]),Ce,Ae])]),default:a(()=>[o(k,{"tab-position":e.tabPosition},{default:a(()=>[o(l,{label:"\u57FA\u672C\u8BBE\u7F6E"},{default:a(()=>[Pe,u("div",ye,[u("div",De,[o(E,{ref:"settingFormRef",model:e.settingForm,rules:e.rules,"label-width":"100px",class:"demo-ruleForm"},{default:a(()=>[o(d,{label:"\u7528\u6237\u540D\u79F0",prop:"nickname"},{default:a(()=>[o(i,{modelValue:e.settingForm.username,"onUpdate:modelValue":s[0]||(s[0]=p=>e.settingForm.username=p),placeholder:"\u8BF7\u8F93\u5165\u7528\u6237\u540D",maxlength:"10"},null,8,["modelValue"])]),_:1}),o(d,{label:"\u8054\u7CFB\u7535\u8BDD",prop:"mobile"},{default:a(()=>[o(i,{modelValue:e.settingForm.phone,"onUpdate:modelValue":s[1]||(s[1]=p=>e.settingForm.phone=p),placeholder:"\u8BF7\u8F93\u516511\u4F4D\u5927\u9646\u624B\u673A\u53F7\u7801"},null,8,["modelValue"])]),_:1}),o(d,{label:"\u4E2A\u4EBA\u7B80\u4ECB",prop:"desc"},{default:a(()=>[o(i,{modelValue:e.settingForm.intro,"onUpdate:modelValue":s[2]||(s[2]=p=>e.settingForm.intro=p),type:"textarea",placeholder:"\u4E2A\u4EBA\u7B80\u4ECB",maxlength:"120"},null,8,["modelValue"])]),_:1}),o(d,null,{default:a(()=>[o(r,{type:"primary",loading:e.updateLoading,onClick:s[3]||(s[3]=p=>e.submitForm())},{default:a(()=>[Se]),_:1},8,["loading"]),o(r,{onClick:s[4]||(s[4]=p=>e.resetForm())},{default:a(()=>[Ve]),_:1})]),_:1})]),_:1},8,["model","rules"])]),u("div",ke,[u("div",$e,[Ue,u("img",{src:e.getAvatarUrl(e.avatar),referrerPolicy:"no-referrer"},null,8,Ie)]),o(c,{action:"http://localhost:8080/api/upload/uploadAvatar",data:e.additionalParams,"on-success":e.handleAvatarSuccess,"before-upload":e.beforeAvatarUpload},{default:a(()=>[o(r,{type:"primary"},{default:a(()=>[Re]),_:1})]),_:1},8,["data","on-success","before-upload"])])])]),_:1}),o(l,{label:"\u5B89\u5168\u8BBE\u7F6E"},{default:a(()=>[je,u("div",Te,[Me,u("div",{class:"opera-btn",onClick:s[5]||(s[5]=p=>e.showPasswordDialog=!0)},Le)]),u("div",Ne,[u("div",ze,[Oe,u("span",Qe,"\u5DF2\u7ED1\u5B9A\u90AE\u7BB1\uFF1A"+K(e.email),1)]),u("div",{class:"opera-btn",onClick:s[6]||(s[6]=p=>e.showEmailDialog=!0)},He)])]),_:1}),o(l,{label:"\u65B0\u6D88\u606F\u901A\u77E5"},{default:a(()=>[Je,u("div",Ke,[We,o(y,{content:"\u662F\u5426\u5F00\u542F\u7528\u6237\u4FE1\u606F: ",placement:"top"},{default:a(()=>[o(A,{modelValue:e.userSwitch,"onUpdate:modelValue":s[7]||(s[7]=p=>e.userSwitch=p),"active-color":"#13ce66","inactive-color":"#ff4949","active-value":!0,"inactive-value":!1},null,8,["modelValue"])]),_:1})]),u("div",Xe,[Ye,o(y,{content:"\u662F\u5426\u5F00\u542F\u7CFB\u7EDF\u6D88\u606F: ",placement:"top"},{default:a(()=>[o(A,{modelValue:e.sysSwitch,"onUpdate:modelValue":s[8]||(s[8]=p=>e.sysSwitch=p),"active-color":"#13ce66","inactive-color":"#ff4949","active-value":!0,"inactive-value":!1},null,8,["modelValue"])]),_:1})]),u("div",Ze,[xe,o(y,{content:"\u662F\u5426\u5F00\u542F\u4EE3\u529E\u4EFB\u52A1\u6D88\u606F: ",placement:"top"},{default:a(()=>[o(A,{modelValue:e.taskSwitch,"onUpdate:modelValue":s[9]||(s[9]=p=>e.taskSwitch=p),"active-color":"#13ce66","inactive-color":"#ff4949","active-value":!0,"inactive-value":!1},null,8,["modelValue"])]),_:1})])]),_:1})]),_:1},8,["tab-position"])]),_:1})])]),_:1})]),_:1}),o($,{title:"\u4FEE\u6539\u7ED1\u5B9A\u90AE\u7BB1",visible:e.showEmailDialog,"model-value":e.showEmailDialog,width:"50%","before-close":e.handleClose},{default:a(()=>[o(N,{onSuccess:e.handleSaveEmail},null,8,["onSuccess"])]),_:1},8,["visible","model-value","before-close"]),o($,{title:"\u4FEE\u6539\u5BC6\u7801",visible:e.showPasswordDialog,"model-value":e.showPasswordDialog,width:"50%","before-close":e.handleClose},{default:a(()=>[o(z,{onSuccess:e.handleSavePassword},null,8,["onSuccess"])]),_:1},8,["visible","model-value","before-close"])])}var ns=T(ge,[["render",es],["__scopeId","data-v-7ee9d334"]]);export{ns as default};
