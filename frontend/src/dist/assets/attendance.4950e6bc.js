var q=Object.defineProperty,G=Object.defineProperties;var J=Object.getOwnPropertyDescriptors;var O=Object.getOwnPropertySymbols;var W=Object.prototype.hasOwnProperty,X=Object.prototype.propertyIsEnumerable;var z=(e,o,l)=>o in e?q(e,o,{enumerable:!0,configurable:!0,writable:!0,value:l}):e[o]=l,S=(e,o)=>{for(var l in o||(o={}))W.call(o,l)&&z(e,l,o[l]);if(O)for(var l of O(o))X.call(o,l)&&z(e,l,o[l]);return e},R=(e,o)=>G(e,J(o));import{_ as $}from"./index.63817855.js";import{e as P,R as Y,B as K,k as Z,D as N,m as u,aB as M,O as x,f as I,g as U,t,s,Q as m,y as F,A as ee,ax as V,aR as te,aF as ae,aO as ne,aP as se,aQ as oe,aG as ue,aH as le,w as re,c as ce,q as ie,N as B,d as L,E as c,i as de}from"./vendor.e05abf4c.js";import{A as pe,S as y}from"./attendanceStatistic.8b18b948.js";const me=P({name:"RoleDetail",props:{currentRow:{type:Object,default:()=>({userId:null,userName:"",userDepartment:"",userRole:"",userPhone:"",userAvatar:""})}},setup(e){const o=Y(e,"currentRow"),l=K({loading:!1,form:{userId:1,userName:"",userRole:"",userDepartment:"",userPhone:"",userEmail:"",userAvatar:""}}),C=[{value:"IT",label:"\u6280\u672F\u90E8"},{value:"Market",label:"\u5E02\u573A\u90E8"},{value:"HR",label:"\u4EBA\u529B\u8D44\u6E90\u90E8"}],g=[{value:"admin",label:"\u7BA1\u7406\u5458"},{value:"manager",label:"\u90E8\u95E8\u7ECF\u7406"},{value:"worker",label:"\u5458\u5DE5"}],w=_=>{const d=C.find(h=>h.value===_);return d?d.label:"\u672A\u77E5"},i=_=>{const d=g.find(h=>h.value===_);return d?d.label:"\u672A\u77E5"},r=Z(()=>o.value);return R(S({},N(l)),{departments:C,roles:g,departmentLabel:w,roleLabel:i,row:r})}}),fe={class:"new"};function Ee(e,o,l,C,g,w){const i=u("el-descriptions-item"),r=u("el-descriptions"),_=M("loading");return x((I(),U("div",fe,[t(r,{column:1,border:""},{default:s(()=>[t(i,{label:"\u65E5\u671F"},{default:s(()=>[m(F(e.row.attendanceDate),1)]),_:1}),t(i,{label:"\u4E0A\u73ED\u6253\u5361\u65F6\u95F4"},{default:s(()=>[m(F(e.row.checkIn),1)]),_:1}),t(i,{label:"\u4E0A\u73ED\u6253\u5361\u4F4D\u7F6E"},{default:s(()=>[m(F(e.row.inLocation),1)]),_:1}),t(i,{label:"\u4E0B\u73ED\u6253\u5361\u65F6\u95F4"},{default:s(()=>[m(F(e.row.checkOut),1)]),_:1}),t(i,{label:"\u4E0B\u73ED\u6253\u5361\u4F4D\u7F6E"},{default:s(()=>[m(F(e.row.outLocation),1)]),_:1}),t(i,{label:"\u8003\u52E4\u72B6\u6001"},{default:s(()=>[m(F(e.row.status),1)]),_:1})]),_:1})])),[[_,e.loading]])}var _e=$(me,[["render",Ee],["__scopeId","data-v-7a44d998"]]);const he=P({name:"Attendance",computed:{Search(){return ee},Refresh(){return V}},components:{Odometer:te,InfoFilled:ae,Printer:ne,Download:se,PersonalAttendanceDetail:_e,AttendanceStatistic:pe,Edit:oe,Minus:ue,Plus:le,Refresh:V},setup(){const e=K({url:{c:"/Attendance/add",r:"/Attendance/list",u:"/Attendance/update",d:"/Attendance/delete"},param:{total:0,size:10,page:1},data:[{attendanceDate:"",status:""}],filteredData:[],loading:!1,is_search:!1,add_visible:!1,edit_visible:!1,detail_visible:!1,statistic_visible:!1,posted:{userRow:{id:null,attendanceDate:"",checkIn:"",checkOut:"",inLocation:"",outLocation:"",status:""}},sortField:"",sortOrder:"",userIds:[],selectionRows:[],searchKeyword:""}),o=async()=>{try{if(await B.confirm("\u4E0A\u73ED\u6253\u5361, \u662F\u5426\u7EE7\u7EED?","\u63D0\u793A",{confirmButtonText:"\u786E\u5B9A",cancelButtonText:"\u53D6\u6D88",type:"warning"})){const n=await L.get("https://restapi.amap.com/v3/ip",{params:{key:"112f7278845a2b4a727d04cffeb63b0b"}}),p={accessToken:sessionStorage.getItem("accessToken"),inLocation:n.data.city},D=await y.postCheckInAttendance(p);D.status===0?(c({type:"success",message:"\u4E0A\u73ED\u6253\u5361\u6210\u529F"}),r()):D.status===-1?c({type:"warning",message:"\u5DF2\u7ECF\u4E0A\u73ED\u6253\u5361\u8FC7\u4E86"}):c({type:"error",message:"\u6253\u5361\u5931\u8D25"})}}catch{c({type:"info",message:"\u5DF2\u53D6\u6D88\u6253\u5361"})}},l=async()=>{B.confirm("\u4E0B\u73ED\u6253\u5361, \u662F\u5426\u7EE7\u7EED?","\u63D0\u793A",{confirmButtonText:"\u786E\u5B9A",cancelButtonText:"\u53D6\u6D88",type:"warning"}).then(async()=>{const a=await L.get("https://restapi.amap.com/v3/ip",{params:{key:"112f7278845a2b4a727d04cffeb63b0b"}}),n={accessToken:sessionStorage.getItem("accessToken"),outLocation:a.data.city},p=await y.postCheckOutAttendance(n);p.status===0?(c({type:"success",message:"\u4E0B\u73ED\u6253\u5361\u6210\u529F"}),r()):p.status===-1?c({type:"warning",message:"\u5DF2\u7ECF\u4E0B\u73ED\u6253\u5361\u8FC7\u4E86"}):p.status===-2?c({type:"warning",message:"\u4ECA\u5929\u8FD8\u6CA1\u4E0A\u73ED\u6253\u5361"}):c({type:"error",message:"\u6253\u5361\u5931\u8D25"})}).catch(()=>{c({type:"info",message:"\u5DF2\u53D6\u6D88\u6253\u5361"})})},C=async()=>{e.statistic_visible=!0},g=()=>e.sortField?[...e.data].sort((a,n)=>{const p=a[e.sortField],D=n[e.sortField];return p<D?e.sortOrder==="asc"?-1:1:p>D?e.sortOrder==="asc"?1:-1:0}):e.data,w=({prop:a,order:n})=>{e.sortField=a,e.sortOrder=n==="ascending"?"asc":"desc"},i=a=>{e.selectionRows=a.map(n=>n.id)},r=async()=>{e.is_search=!1;const a={accessToken:sessionStorage.getItem("accessToken")},n=await y.postPersonalAttendance(a);n.status===0&&(await L.get("https://restapi.amap.com/v3/ip",{params:{key:"112f7278845a2b4a727d04cffeb63b0b"}}),e.data=n.data,e.userIds=n.data.map(p=>p.id),e.param.total=e.data.length)},_=a=>{e.param.page=a},d=a=>{e.param.page=1,e.param.size=a},h=()=>e.is_search?g().filter(a=>a.attendanceDate.toLowerCase().includes(e.searchKeyword.toLowerCase())||a.status.toLowerCase().includes(e.searchKeyword.toLowerCase())).slice((e.param.page-1)*e.param.size,e.param.page*e.param.size):g().slice((e.param.page-1)*e.param.size,e.param.page*e.param.size),b=()=>{e.searchKeyword!=""?(e.is_search=!0,e.param.page=1,e.filteredData=e.data.filter(a=>a.attendanceDate.toLowerCase().includes(e.searchKeyword.toLowerCase())||a.status.toLowerCase().includes(e.searchKeyword.toLowerCase())),e.param.total=e.filteredData.length):(e.is_search=!1,e.param.page=1,e.param.total=e.data.length)},A=(a,n)=>{e.posted.userRow.attendanceDate=n.attendanceDate,e.posted.userRow.checkIn=n.checkIn,e.posted.userRow.inLocation=n.inLocation,e.posted.userRow.checkOut=n.checkOut,e.posted.userRow.outLocation=n.outLocation,e.posted.userRow.status=n.status,e.detail_visible=!0},k=async()=>{B.confirm("\u786E\u5B9A\u8981\u5BFC\u51FA\u4E3AExcel\u5417","\u6E29\u99A8\u63D0\u793A",{confirmButtonText:"\u786E\u5B9A",cancelButtonText:"\u53D6\u6D88",type:"info"}).then(async()=>{const a=e.selectionRows.length>0?e.selectionRows:e.userIds,n={accessToken:sessionStorage.getItem("accessToken"),user_ids:a};y.postAdminExportAttendance(n).then(()=>{c({type:"success",message:"Excel \u6587\u4EF6\u6B63\u5728\u4E0B\u8F7D..."})}).catch(()=>{c({type:"error",message:"\u4E0B\u8F7D\u5931\u8D25\uFF0C\u8BF7\u91CD\u8BD5"})})}).catch(()=>{c({type:"info",message:"\u5DF2\u53D6\u6D88"})})},E=async()=>{B.confirm("\u786E\u5B9A\u8981\u4E0B\u8F7DPDF\u5417","\u6E29\u99A8\u63D0\u793A",{confirmButtonText:"\u786E\u5B9A",cancelButtonText:"\u53D6\u6D88",type:"info"}).then(async()=>{const a=e.selectionRows.length>0?e.selectionRows:e.userIds,n={accessToken:sessionStorage.getItem("accessToken"),user_ids:a};y.postAdminPrintAttendance(n).then(()=>{c({type:"success",message:"PDF \u6587\u4EF6\u6B63\u5728\u4E0B\u8F7D..."})}).catch(()=>{c({type:"error",message:"\u4E0B\u8F7D\u5931\u8D25\uFF0C\u8BF7\u91CD\u8BD5"})})}).catch(()=>{c({type:"info",message:"\u5DF2\u53D6\u6D88"})})},v=(a,n)=>n.status===a;return re(()=>e.searchKeyword,a=>{b()}),ce(()=>{r(),h()}),R(S({},N(e)),{displayData:h,handleSelectionChange:i,onCurrentChange:_,onSizeChange:d,onStatistic:C,onDetail:A,onSearch:b,onExport:k,onPrint:E,fetchData:r,handleSortChange:w,filterStatus:v,onCheckIn:o,onCheckOut:l})}}),ge=m("\u4E0A\u73ED\u6253\u5361"),De=m("\u4E0B\u73ED\u6253\u5361"),Fe=m("\u5BFC\u51FA\u5217\u8868"),Ce=m("\u6253\u5370\u5217\u8868"),we=m("\u7EDF\u8BA1\u4FE1\u606F"),ye=de("br",null,null,-1);function be(e,o,l,C,g,w){const i=u("el-row"),r=u("el-button"),_=u("download"),d=u("el-icon"),h=u("printer"),b=u("odometer"),A=u("el-col"),k=u("el-input"),E=u("el-table-column"),v=u("el-tag"),a=u("InfoFilled"),n=u("el-tooltip"),p=u("el-table"),D=u("el-card"),H=u("personal-attendance-detail"),T=u("el-dialog"),Q=u("attendance-statistic"),j=M("loading");return I(),U("div",null,[t(D,{class:"card-ctrl"},{default:s(()=>[t(i,{style:{margin:"15px"}}),t(i,null,{default:s(()=>[t(A,{span:10,style:{"text-align":"left"}},{default:s(()=>[t(r,{type:"primary",size:"medium",onClick:e.onCheckIn},{default:s(()=>[ge]),_:1},8,["onClick"]),t(r,{type:"primary",size:"medium",onClick:e.onCheckOut},{default:s(()=>[De]),_:1},8,["onClick"]),t(r,{type:"info",size:"medium",onClick:e.onExport},{default:s(()=>[t(d,null,{default:s(()=>[t(_)]),_:1}),Fe]),_:1},8,["onClick"]),t(r,{type:"info",size:"medium",onClick:e.onPrint},{default:s(()=>[t(d,null,{default:s(()=>[t(h)]),_:1}),Ce]),_:1},8,["onClick"]),t(r,{type:"success",size:"medium",onClick:e.onStatistic},{default:s(()=>[t(d,null,{default:s(()=>[t(b)]),_:1}),we]),_:1},8,["onClick"])]),_:1}),t(A,{span:14,style:{"text-align":"right"}},{default:s(()=>[t(k,{modelValue:e.searchKeyword,"onUpdate:modelValue":o[0]||(o[0]=f=>e.searchKeyword=f),placeholder:"\u8BF7\u8F93\u5165\u5173\u952E\u8BCD",style:{width:"200px","margin-right":"10px"}},null,8,["modelValue"])]),_:1})]),_:1}),ye,x((I(),ie(p,{data:e.displayData(),stripe:"",class:"table",onSelectionChange:e.handleSelectionChange},{default:s(()=>[t(E,{type:"selection",width:"55",align:"center",sortable:"",onSortChange:e.handleSortChange},null,8,["onSortChange"]),t(E,{prop:"attendanceDate",label:"\u65E5\u671F",align:"center",sortable:"",onSortChange:e.handleSortChange},null,8,["onSortChange"]),t(E,{prop:"checkIn",label:"\u4E0A\u73ED\u6253\u5361\u65F6\u95F4",align:"center",sortable:"",onSortChange:e.handleSortChange},null,8,["onSortChange"]),t(E,{prop:"inLocation",label:"\u4E0A\u73ED\u6253\u5361\u4F4D\u7F6E",align:"center",sortable:"",onSortChange:e.handleSortChange},null,8,["onSortChange"]),t(E,{prop:"checkOut",label:"\u4E0B\u73ED\u6253\u5361\u65F6\u95F4",align:"center",sortable:"",onSortChange:e.handleSortChange},null,8,["onSortChange"]),t(E,{prop:"outLocation",label:"\u4E0B\u73ED\u6253\u5361\u4F4D\u7F6E",align:"center",sortable:"",onSortChange:e.handleSortChange},null,8,["onSortChange"]),t(E,{prop:"status",label:"\u8003\u52E4\u72B6\u6001",width:"150",filters:[{text:"\u51C6\u65F6",value:"On Time"},{text:"\u8FDF\u5230",value:"Late"},{text:"\u65E9\u9000",value:"Leave Early"},{text:"\u7F3A\u5E2D",value:"Absent"},{text:"\u8FDF\u5230\u4E14\u7F3A\u5E2D",value:"Late And Leave Early"}],"filter-method":e.filterStatus,"filter-placement":"bottom-end"},{default:s(f=>[t(v,{type:f.row.status===2?"primary":"success","disable-transitions":""},{default:s(()=>[m(F(f.row.status),1)]),_:2},1032,["type"])]),_:1},8,["filter-method"]),t(E,{label:"\u64CD\u4F5C",align:"center"},{default:s(f=>[t(n,{class:"item",effect:"dark",content:"\u8BE6\u60C5",placement:"bottom"},{default:s(()=>[t(r,{circle:"",plain:"",type:"info",size:"small",onClick:Ae=>e.onDetail(f.$index,f.row)},{default:s(()=>[t(d,null,{default:s(()=>[t(a)]),_:1})]),_:2},1032,["onClick"])]),_:2},1024)]),_:1})]),_:1},8,["data","onSelectionChange"])),[[j,e.loading]])]),_:1}),t(T,{modelValue:e.detail_visible,"onUpdate:modelValue":o[1]||(o[1]=f=>e.detail_visible=f),center:"",title:"\u8003\u52E4\u8BE6\u60C5"},{default:s(()=>[t(H,{"current-row":e.posted.userRow},null,8,["current-row"])]),_:1},8,["modelValue"]),t(T,{modelValue:e.statistic_visible,"onUpdate:modelValue":o[2]||(o[2]=f=>e.statistic_visible=f),center:"",title:"\u7EDF\u8BA1\u4FE1\u606F"},{default:s(()=>[t(Q,{data:e.data},null,8,["data"])]),_:1},8,["modelValue"])])}var Re=$(he,[["render",be]]);export{Re as default};
